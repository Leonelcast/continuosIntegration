<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Controlador.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ventas</a> &gt; <a href="index.source.html" class="el_package">com.ventas.ventas</a> &gt; <span class="el_source">Controlador.java</span></div><h1>Controlador.java</h1><pre class="source lang-java linenums">
package com.ventas.ventas;

import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Base64;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import org.hibernate.annotations.Any;
import org.hibernate.cache.spi.support.AbstractReadWriteAccess.Item;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpRequest;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.servlet.ModelAndView;

//Rest
import java.util.concurrent.atomic.AtomicLong;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
/**
 * &lt;p&gt;El controlador, sirve para mostrar, redireccionar las paginas web, asi como mostrar los resultados de las paginas web&lt;/p&gt;
 */
@Controller
<span class="fc" id="L47">public class Controlador {</span>
    String session2; 
    int id_session2; 
    @Autowired 
    private Correo correo; 

    @Autowired(required = true)
    private Dao dao;
    /**
     * &lt;p&gt;
     * Método para ver los dispositivos del sistema de ventas
     * &lt;/p&gt;
     * 
     * @param model   mostrar el html de los dispositivos
     * @param session sesion logeada
     * @return Se muestra la pagina html para mostrar todos los dispositivos que
     *         existen el sistema de ventas y mostrar las operaciones que puede
     *         realizar dependiento el tipo de usuario que ingrese.
     */
    @RequestMapping(&quot;/&quot;)
    public String viewHomePage(final Model model, HttpSession session) {
<span class="nc" id="L68">        final List&lt;Telefono&gt; listaDis = dao.list();</span>
<span class="nc" id="L69">        model.addAttribute(&quot;listaDis&quot;, listaDis);</span>
        //model.addAttribute(&quot;imgUtil&quot;, new ImageUtil());

<span class="nc bnc" id="L72" title="All 2 branches missed.">        if (session.getAttribute(&quot;name&quot;) == null) {</span>
<span class="nc" id="L73">            return &quot;accesoProhibido.html&quot;;</span>
        } else {
<span class="nc" id="L75">            return &quot;index.html&quot;;</span>

        }

    }

    /**
     * &lt;p&gt;
     * Método para editar el dispositivo individual
     * &lt;/p&gt;
     * 
     * @param id      para llamar el id del dispositivo
     * @param session sesion logeada
     * @return Se muestra el model con los datos de cada dispositivo individual,
     *         para que se pueda realizar una modificación y se guarde los cambios
     *         que se realizaron.
     */
    @RequestMapping(&quot;/individual/{id}&quot;)
    public ModelAndView showEditForm(@PathVariable(name = &quot;id&quot;) int id, HttpSession session) {
<span class="nc" id="L94">        ModelAndView mav = new ModelAndView(&quot;individual&quot;);</span>
<span class="nc" id="L95">        Telefono nuevo = dao.get(id);</span>
<span class="nc" id="L96">        mav.addObject(&quot;nuevo&quot;, nuevo);</span>

<span class="nc" id="L98">        return mav;</span>
    }

    /**
     * &lt;p&gt;
     * Método para mostrar el dispositivo individual
     * &lt;/p&gt;
     * 
     * @param model para mostrar la pagina del html del dispositivo individual
     * @param id    para que mande a llamar el id que tiene el dispositivo
     * @return Se muestra el html del dispositivo individual que fue seleccionado
     *         para que muestre todas sus caracteristicas y también las imagenes que
     *         tiene ese dispositivo.
     */
    @RequestMapping(value = &quot;/individual/{id}&quot;, method = RequestMethod.GET)
    public String view(final Model model, @PathVariable(&quot;id&quot;) int id) {
<span class="nc" id="L114">        final List&lt;Telefono&gt; listaDis = dao.list2(id);</span>
<span class="nc" id="L115">        final List&lt;Telefono&gt; opciones = dao.listOpciones(&quot;Select *from VENTAS.fabrica&quot;);</span>
<span class="nc" id="L116">        model.addAttribute(&quot;opciones&quot;, opciones);</span>
<span class="nc" id="L117">        model.addAttribute(&quot;listaDis&quot;, listaDis);</span>
<span class="nc" id="L118">        model.addAttribute(&quot;imgUtil&quot;, new ImageUtil());</span>
<span class="nc" id="L119">        final List&lt;Cliente&gt; listCli = dao.listaCliente();</span>
<span class="nc" id="L120">        model.addAttribute(&quot;listCli&quot;, listCli);</span>

<span class="nc" id="L122">        return &quot;individual.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para actualizar la imagen de los dispositivos individuales
     * &lt;/p&gt;
     * 
     * @param foto1   para mostrar la foto 1 del dispositivo individual
     * @param foto2   para mostrar la foto 2 del dispositivo individual
     * @param foto3   para mostrar la foto 3 del dispositivo individual
     * @param id      para que manda a llamar el id del dispositivo individual
     *                seleccionado
     * @param session para la sesion logeada
     * @return Se mostrara un model donde tendra los campos para que se pueda
     *         ingresar las imagenes de los dispositivos individuales
     */
    // Actualizar foto
    @RequestMapping(value = &quot;/updateImg&quot;, method = RequestMethod.POST)
    public String update(@RequestParam(name = &quot;foto1&quot;) MultipartFile foto1,
            @RequestParam(name = &quot;foto2&quot;) MultipartFile foto2, @RequestParam(name = &quot;foto3&quot;) MultipartFile foto3,
            @RequestParam(name = &quot;id_bodega&quot;) int id, HttpSession session) throws IOException {

<span class="nc" id="L145">        byte[] fotoa = foto1.getBytes();</span>
<span class="nc" id="L146">        byte[] fotob = foto2.getBytes();</span>
<span class="nc" id="L147">        byte[] fotoc = foto3.getBytes();</span>
<span class="nc" id="L148">        dao.updateF(fotoa, &quot;UPDATE VENTAS.BODEGA SET foto1=? WHERE id_bodega=?&quot;, id);</span>
<span class="nc" id="L149">        dao.updateF(fotob, &quot;UPDATE VENTAS.BODEGA SET foto2=? WHERE id_bodega=?&quot;, id);</span>
<span class="nc" id="L150">        dao.updateF(fotoc, &quot;UPDATE VENTAS.BODEGA SET foto3=? WHERE id_bodega=?&quot;, id);</span>

<span class="nc" id="L152">        String tabla = &quot;Bodega&quot;;</span>
<span class="nc" id="L153">        dao.historialC(session2, &quot;Update&quot;, tabla);</span>

<span class="nc" id="L155">        return &quot;redirect:/&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para para insertar un dispositivo
     * &lt;/p&gt;
     * 
     * @param model para mostrar la pagina html de las caracteristicas del
     *              dispositivo
     * @return Se mostrara un html con los campos que se deberan ingresar para que
     *         se agrege un nuevo dispositivo en el sistema de ventas.
     */
    // insertar telefono
    @RequestMapping(&quot;/new&quot;)
    public String showNewForm(Model model) {
<span class="nc" id="L171">        Telefono nuevo = new Telefono();</span>
<span class="nc" id="L172">        model.addAttribute(&quot;nuevo&quot;, nuevo);</span>
<span class="nc" id="L173">        final List&lt;Telefono&gt; opciones = dao.listOpciones(&quot;Select *from VENTAS.fabrica&quot;);</span>
<span class="nc" id="L174">        model.addAttribute(&quot;opciones&quot;, opciones);</span>
<span class="nc" id="L175">        return &quot;new&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para guardar los datos de un dispositivo
     * &lt;/p&gt;
     * 
     * @param nuevo para guardar los datos del dispositivo
     * @return Se mostrara en el la pagia html de dispositivos el nuevo dispositivo
     *         agregado.
     */
    @RequestMapping(value = &quot;/save&quot;, method = RequestMethod.POST)
    public String save(@ModelAttribute(&quot;nuevo&quot;) Telefono nuevo) throws IOException {
<span class="nc" id="L189">        dao.save(nuevo);</span>

<span class="nc" id="L191">        String tabla = &quot;Bodega&quot;;</span>
<span class="nc" id="L192">        dao.historialC(session2, &quot;Insertar&quot;, tabla);</span>

<span class="nc" id="L194">        return &quot;redirect:/&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para eliminar un dispositivo
     * &lt;/p&gt;
     * 
     * @param id para llamar el id del dispositivo seleccionado
     * @return Se mostrara en el la pagia html de dispositivos sin el dispositivo
     *         que fue eliminado.
     */
    // delete telefono
    @RequestMapping(&quot;/delete/{id}&quot;)
    public String delete(@PathVariable(name = &quot;id&quot;) int id) throws IOException {
<span class="nc" id="L209">        dao.delete(id);</span>
<span class="nc" id="L210">        String tabla = &quot;Bodega&quot;;</span>
<span class="nc" id="L211">        dao.historialC(session2, &quot;Delete&quot;, tabla);</span>
<span class="nc" id="L212">        return &quot;redirect:/&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para actualizar un dispositivo
     * &lt;/p&gt;
     * 
     * @param nuevo para guardar los datos del dispositivo actualizados
     * @return Se mostrara en el la pagia html de dispositivos con los cambios del
     *         dispositivo.
     */
    // actualizar telefono
    @RequestMapping(value = &quot;/updatePh&quot;, method = RequestMethod.POST)
    public String updatePh(@ModelAttribute(&quot;nuevo&quot;) Telefono nuevo) throws IOException {
<span class="nc" id="L227">        dao.updateT(nuevo);</span>

<span class="nc" id="L229">        String tabla = &quot;Bodega&quot;;</span>
<span class="nc" id="L230">        dao.historialC(session2, &quot;Update&quot;, tabla);</span>
<span class="nc" id="L231">        return &quot;redirect:/&quot;;</span>

    }

    /**
     * &lt;p&gt;
     * Método para buscar un dispositivo
     * &lt;/p&gt;
     * 
     * @param model  para mostrar la pagina html del dispositivo buscado
     * @param buscar para guardar los datos del dispositivo actualizados
     * @return Se mostrara en el la pagia html donde se podra buscar el dispositivo
     *         que se necesite ingresando el parametro a buscar para que se muestre
     *         en la pagina.
     * 
     */
    // Busqueda telefono

    @RequestMapping(value = &quot;/busqueda&quot;, method = RequestMethod.GET)
    public String viewBusqueda(final Model model, @RequestParam(value = &quot;buscar&quot;, required = false) String buscar) {
<span class="fc" id="L251">        buscar = &quot;%&quot; + buscar + &quot;%&quot;;</span>
<span class="fc" id="L252">        final List&lt;Telefono&gt; listaDis = dao.listBus(buscar);</span>
<span class="fc" id="L253">        model.addAttribute(&quot;listaDis&quot;, listaDis);</span>
<span class="fc" id="L254">        model.addAttribute(&quot;imgUtil&quot;, new ImageUtil());</span>

<span class="fc" id="L256">        return &quot;busqueda.html&quot;;</span>
    }

    // clientes
    /**
     * &lt;p&gt;
     * Método para mostrar clientes
     * &lt;/p&gt;
     * 
     * @param model para mostrar la pagina html de los clientes
     * @return Se mostrara en el la pagia html todos los clientes que existen en
     *         nuestro sistema de ventas.
     * 
     */
    // read
    @RequestMapping(value = &quot;/clientes&quot;)
    public String viewcli(final Model model) {
<span class="nc" id="L273">        final List&lt;Cliente&gt; listCli = dao.listaCliente();</span>
<span class="nc" id="L274">        model.addAttribute(&quot;listCli&quot;, listCli);</span>
<span class="nc" id="L275">        return &quot;clientes.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para insertar un cliente
     * &lt;/p&gt;
     * 
     * @param model para mostrar la pagina html ingresar un cliente
     * @return Se mostrara en el la pagia html con los campos que se deben de llenar
     *         para ingresar un cliente en el sitema de ventas.
     * 
     */
    // insert
    @RequestMapping(&quot;/cliente&quot;)
    public String viewCliente(Model model) throws IOException {
<span class="nc" id="L291">        Cliente ci = new Cliente();</span>
<span class="nc" id="L292">        model.addAttribute(&quot;ci&quot;, ci);</span>
<span class="nc" id="L293">        final List&lt;Cliente&gt; opciones = dao.listOpcionesC(&quot;Select *from VENTAS.tipo_clientes&quot;);</span>
<span class="nc" id="L294">        model.addAttribute(&quot;opciones&quot;, opciones);</span>

<span class="nc" id="L296">        return &quot;cliente.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para guardar un cliente
     * &lt;/p&gt;
     * 
     * @param ci para guardar los datos de un cliente
     * @return Se mostrara en el la pagia html con el cliente que fue ingresado en
     *         el sistema.
     * 
     */
    @RequestMapping(value = &quot;/saveCliente&quot;, method = RequestMethod.POST)
    public String saveCliente(@ModelAttribute(&quot;ci&quot;) Cliente ci) throws IOException {
<span class="nc" id="L311">        dao.saveCliente(ci);</span>

<span class="nc" id="L313">        String tabla = &quot;Clientes&quot;;</span>
<span class="nc" id="L314">        dao.historialC(session2, &quot;Insertar&quot;, tabla);</span>

<span class="nc" id="L316">        return &quot;redirect:/clientes&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para eliminar un cliente
     * &lt;/p&gt;
     * 
     * @param id para llamar el id del cliente que fue seleccionado
     * @return Se mostrara en el la pagia html sin el cliente que fue seleccionado
     *         para eliminar del sistema.
     * 
     */
    // delete
    @RequestMapping(&quot;/deletecliente/{id}&quot;)
    public String deletecliente(@PathVariable(name = &quot;id&quot;) int id) throws IOException {
<span class="nc" id="L332">        dao.deletecliente(id);</span>

<span class="nc" id="L334">        String tabla = &quot;Clientes&quot;;</span>
<span class="nc" id="L335">        dao.historialC(session2, &quot;Delete&quot;, tabla);</span>
<span class="nc" id="L336">        return &quot;redirect:/clientes&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para actualizar un cliente
     * &lt;/p&gt;
     * 
     * @param id para llamar el id del cliente que fue seleccionado
     * @return Se redireccionar a la pagina html con la informacion del cliente que
     *         fue seleccionado.
     * 
     */
    // update
    @RequestMapping(&quot;/updateC/{id}&quot;)
    public ModelAndView updateC(@PathVariable(name = &quot;id&quot;) int id) {
<span class="nc" id="L352">        ModelAndView mav = new ModelAndView(&quot;updateC&quot;);</span>
<span class="nc" id="L353">        Cliente ci = dao.getC(id);</span>
<span class="nc" id="L354">        mav.addObject(&quot;ci&quot;, ci);</span>

<span class="nc" id="L356">        return mav;</span>
    }

    /**
     * &lt;p&gt;
     * Método para actualizar datos de un cliente
     * &lt;/p&gt;
     * 
     * @param model para mostrar la pagina html de actualización de un cliente
     * @param id    para llamar el id del cliente que fue seleccionado
     * @return Se mostrara en el la pagia html con los datos del cliente que se
     *         selecciono para que sea modificado.
     * 
     */
    @RequestMapping(value = &quot;/updateC/{id}&quot;, method = RequestMethod.GET)
    public String viewC2(final Model model, @PathVariable(&quot;id&quot;) int id) {
<span class="nc" id="L372">        final List&lt;Cliente&gt; listCli = dao.listaCliente2(id);</span>
<span class="nc" id="L373">        model.addAttribute(&quot;listCli&quot;, listCli);</span>
<span class="nc" id="L374">        return &quot;updateC.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para guardar los datos actualizados de un cliente
     * &lt;/p&gt;
     * 
     * @param ci para guardar los datos del cliente
     * @return Se guardaran los cambios del cliente y se mostrara por último los
     *         datos cambiados en la pagina html.
     */
    @RequestMapping(value = &quot;/updateC&quot;, method = RequestMethod.POST)
    public String updateC(@ModelAttribute(&quot;clienteN&quot;) Cliente ci) throws IOException {
<span class="nc" id="L388">        dao.updateC(ci);</span>
<span class="nc" id="L389">        String tabla = &quot;Clientes&quot;;</span>
<span class="nc" id="L390">        dao.historialC(session2, &quot;Update&quot;, tabla);</span>

<span class="nc" id="L392">        return &quot;redirect:/clientes&quot;;</span>
    }

    // Marca
    // Marca
    /**
     * &lt;p&gt;
     * Método para mostrar las marcas de los dispositivos
     * &lt;/p&gt;
     * 
     * @param model para mostrar la pagina html de marcas de dispositivos
     * @return Se mostrara en el la pagia html todas las marcas de los dispositivos
     *         que tiene el sistema de ventas.
     */
    // read
    @RequestMapping(value = &quot;/marcas&quot;)
    public String viewMar(final Model model) {
<span class="nc" id="L409">        final List&lt;Marca&gt; listMar = dao.listMarca();</span>
<span class="nc" id="L410">        model.addAttribute(&quot;listMar&quot;, listMar);</span>
<span class="nc" id="L411">        return &quot;marcas.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para insertar una marca de dispositivo
     * &lt;/p&gt;
     * 
     * @param model para mostrar la pagina html de marca
     * @return Se mostrara en el la pagia html con todos los campos para insertar
     *         una nueva marca de dispositivos.
     */
    // insert
    @RequestMapping(&quot;/addMarca&quot;)
    public String viewMarca(Model model) {
<span class="nc" id="L426">        Marca ma = new Marca();</span>
<span class="nc" id="L427">        model.addAttribute(&quot;ma&quot;, ma);</span>
<span class="nc" id="L428">        return &quot;addMarca&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para guardar la marca del dispositivo
     * &lt;/p&gt;
     * 
     * @param ma para guardar los datos de la marca del dispositivo
     * @return Se mostrara en el la pagia html la marca insertada del dispositivo
     *         con todos sus datos.
     */
    @RequestMapping(value = &quot;/saveMarca&quot;, method = RequestMethod.POST)
    public String saveMarca(@ModelAttribute(&quot;ma&quot;) Marca ma) throws IOException {
<span class="nc" id="L442">        dao.saveMarca(ma);</span>
<span class="nc" id="L443">        String tabla = &quot;Marcas&quot;;</span>
<span class="nc" id="L444">        dao.historialC(session2, &quot;Insert&quot;, tabla);</span>

<span class="nc" id="L446">        return &quot;redirect:/marcas&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para eliminar la marca del dispositivo
     * &lt;/p&gt;
     * 
     * @param id para llamar el id de la marca del dispositivo seleccionada
     * @return Se mostrara en el la pagia html sin la marca de dispositivo que fue
     *         seleccionado para eliminar del sistema.
     */
    // delete
    @RequestMapping(&quot;/deleteMarca/{id}&quot;)
    public String deleteMarca(@PathVariable(name = &quot;id&quot;) int id) throws IOException {
<span class="nc" id="L461">        dao.deleteMarca(id);</span>
<span class="nc" id="L462">        String tabla = &quot;Marcas&quot;;</span>
<span class="nc" id="L463">        dao.historialC(session2, &quot;Delete&quot;, tabla);</span>
<span class="nc" id="L464">        return &quot;redirect:/marcas&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para actualizar una marca de dispositivo
     * &lt;/p&gt;
     * 
     * @param modelo para mostrar la pagina html deactualizar de la marca del
     *               dispositivo
     * @param id     para llamar el id de la marca del dispositivo que fue
     *               seleccionado
     * @return Se llama a la pagina html con la informacion de la marca que fue
     *         seleccionada para modificar los campos.
     * 
     */
    // update
    @RequestMapping(value = &quot;/updateMarca/{id}&quot;, method = RequestMethod.GET)
    public String viewM(final Model model, @PathVariable(&quot;id&quot;) int id) {
<span class="nc" id="L483">        final List&lt;Marca&gt; listMar = dao.listMar2(id);</span>
<span class="nc" id="L484">        model.addAttribute(&quot;listMar&quot;, listMar);</span>
<span class="nc" id="L485">        return &quot;updateMarca.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para guardar actualizacion de una marca de dispositivo
     * &lt;/p&gt;
     * 
     * @param ma para guardar los datos modificados de la marca de dispositivos
     * @return Se llama a la pagina html de marca de dispostivo con los datos ya
     *         actualizados.
     * 
     */
    @RequestMapping(value = &quot;/updateMarca&quot;, method = RequestMethod.POST)
    public String updateMarca(@ModelAttribute(&quot;ma&quot;) Marca ma) throws IOException {
<span class="nc" id="L500">        dao.updateMarca(ma);</span>
<span class="nc" id="L501">        String tabla = &quot;Marcas&quot;;</span>
<span class="nc" id="L502">        dao.historialC(session2, &quot;Update&quot;, tabla);</span>

<span class="nc" id="L504">        return &quot;redirect:/marcas&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para atender a un cliente
     * &lt;/p&gt;
     * 
     * @param nit     para traer el cliente a atender
     * @param session para llamar al usuario logeado
     * @return Se llama a la pagina html para traer el nombre del cliente que sera
     *         atendido y para ver que tipo de cliente es.
     */
    // Pedido
    @RequestMapping(value = &quot;/atenderCliente&quot;, method = RequestMethod.POST)
    public String log(@RequestParam(name = &quot;nit&quot;) int nit, HttpSession session) throws IOException {
<span class="fc" id="L520">        final List&lt;Cliente&gt; listaDis = dao.clienteNit(nit);</span>

<span class="fc" id="L522">        String usuario = &quot;&quot;;</span>
<span class="fc" id="L523">        int tipo_u = 0;</span>
<span class="fc" id="L524">        int id_cliente = 0;</span>
<span class="fc bfc" id="L525" title="All 2 branches covered.">        for (Cliente cliente : listaDis) {</span>

<span class="fc" id="L527">            usuario += cliente.getNombre();</span>
<span class="fc" id="L528">            tipo_u += cliente.getId_tipo_cliente();</span>
<span class="fc" id="L529">            id_cliente += cliente.getId_cliente();</span>

<span class="fc" id="L531">        }</span>

<span class="pc bpc" id="L533" title="1 of 2 branches missed.">        if (listaDis.size() &gt; 0) {</span>
<span class="fc" id="L534">            session.setAttribute(&quot;nit&quot;, nit);</span>
<span class="fc" id="L535">            session.setAttribute(&quot;cliente&quot;, usuario);</span>
<span class="fc" id="L536">            session.setAttribute(&quot;idT&quot;, tipo_u);</span>
<span class="fc" id="L537">            id_session2 = id_cliente;</span>
<span class="fc" id="L538">            session.setAttribute(&quot;idc&quot;, id_cliente);</span>

<span class="fc" id="L540">            return &quot;redirect:/&quot;;</span>

        } else {
<span class="nc" id="L543">            return &quot;redirect:/&quot;;</span>
        }

    }

    /**
     * &lt;p&gt;
     * Método para hacer un pedido
     * &lt;/p&gt;
     * 
     * @param ma para insertar los pedidos
     * @return Se llama a la pagina html para insertar un pedido de los dispositivos
     *         que desea el cliente.
     */
    @RequestMapping(value = &quot;/pedido&quot;, method = RequestMethod.POST)
    public String añadirPediod(@ModelAttribute(&quot;pedidon&quot;) Pedido ma, @RequestParam(&quot;id_cliente&quot;) int id, @RequestParam(&quot;cantidadp&quot;) int times) throws IOException {

<span class="nc" id="L560">        dao.insertarPedido(ma);</span>
<span class="nc" id="L561">        String tabla = &quot;Pedido&quot;;</span>
<span class="nc" id="L562">        dao.asignarNum(id,times);</span>
<span class="nc" id="L563">        dao.historialC(session2, &quot;Insert&quot;, tabla);</span>

<span class="nc" id="L565">        return &quot;redirect:/&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para mostrar los pedidos
     * &lt;/p&gt;
     * 
     * @param model para mostrar los pedidos del cliente
     * @return Se llama a la pagina html para que muestre todos los pedidos de los
     *         dispositivos que hizo un cliente.
     */
    @RequestMapping(&quot;/carro&quot;)
    public String carro(final Model model) {
<span class="fc" id="L579">        final List&lt;Pedido&gt; listC = dao.mostrarCarro(id_session2);</span>
<span class="fc" id="L580">        model.addAttribute(&quot;listC&quot;, listC);</span>

<span class="fc" id="L582">        return &quot;carro.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para efectuar pago de pedidos al credito
     * &lt;/p&gt;
     * 
     * @param model para mostrar si es pedido al credito
     * @param cerd  para seleccionar pedido al cedito
     * @return Se llama a la pagina html para poder seleccionar la facturación del
     *         pedido es al credito.
     */
    @RequestMapping(value = &quot;/facturar&quot;, method = RequestMethod.POST)
    public String factura(final Model model, @RequestParam(&quot;credito&quot;) int cred) {

<span class="nc" id="L598">        dao.facturar(id_session2, cred);</span>

<span class="nc" id="L600">        return &quot;redirect:/factura&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para facturacion de pedido
     * &lt;/p&gt;
     * 
     * @param model para mostrar la factura de los dispositivos comprados
     * @return Se llama a la pagina html para mostrar los datos para la facturacion
     *         de la compra de los pedidos de un cliente.
     */
    @RequestMapping(&quot;/factura&quot;)
    public String factura(final Model model) {

<span class="fc" id="L615">        final List&lt;Pedido&gt; listaF = dao.mostrarFactura(id_session2);</span>
<span class="fc" id="L616">        model.addAttribute(&quot;listaF&quot;, listaF);</span>
<span class="nc" id="L617">        final List&lt;Pedido&gt; listaT = dao.total(id_session2);</span>
<span class="nc" id="L618">        model.addAttribute(&quot;listaT&quot;, listaT);</span>

<span class="nc" id="L620">        return &quot;factura.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para eliminar un pedido del cliente
     * &lt;/p&gt;
     * 
     * @param id para llamar el id del pedido del cliente
     * @return Se llama el id del pedido del cliente para que se elimine del carrito
     *         de compras.
     */
    @RequestMapping(value = &quot;/eliminarPedido&quot;, method = RequestMethod.POST)
    public String deleteP(@RequestParam(name = &quot;id_pedido&quot;) int id) {

<span class="nc" id="L635">        dao.deletePedido(id);</span>
        ;
<span class="nc" id="L637">        return &quot;redirect:/carro&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para verificar tipo de cliente y descuento
     * &lt;/p&gt;
     * 
     * @param id para llamar el id del cliente que esta comprando
     * @return Se llama el id del cliente que esta comprando un dispositivo para
     *         poder generar un descuento dependiendo que tipo de cliente es el que
     *         esta comprando.
     */
    @RequestMapping(value = &quot;/comprarT&quot;, method = RequestMethod.POST)
    public String comprarT(@RequestParam(name = &quot;id_cliente&quot;) int id) {

<span class="nc" id="L653">        dao.comprarT(id);</span>
  
<span class="nc" id="L655">        return &quot;redirect:/carro&quot;;</span>
    }

    // MANEJO DE USUARIOS
    // Login de usuarios
    /**
     * &lt;p&gt;
     * Método para logearse en el sistema de ventas
     * &lt;/p&gt;
     * 
     * @param model   para mostrar la pagina del html
     * @param session sesion para logearse
     * @return Se muestra el html de iniciar sesion para que el usuario se logee por
     *         medio de nombre y contraseña, se revisa si el usuario existe dejará
     *         ingresar y mostrara los dispositivos y en caso de que el usuario no
     *         existe no se podra logear y aparecera que el acceso es denegado.
     */
    @RequestMapping(&quot;/login&quot;)
    public String verLogin(final Model model, HttpSession session) {
<span class="nc" id="L674">        session.invalidate();</span>
<span class="nc" id="L675">        return &quot;login.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para verificación de usuarios
     * &lt;/p&gt;
     * 
     * @param usuarion   usuario que se ingresa
     * @param contraseña contraseña que se ingresa
     * @param session    sesion para logearse
     * @return Se manda el parametro de usuario y contraseña para que el sistema
     *         peuda validar si existe el usuario y que tipo de usuario es el que
     *         ingresara al sistema. Si no se encuentra el usuario dara una alerta
     *         de accesos denegado.
     */
    @RequestMapping(value = &quot;/log&quot;, method = RequestMethod.POST)
    public String log(@RequestParam(name = &quot;usuario&quot;) String usuarion,
            @RequestParam(name = &quot;contraseña&quot;) String contraseña, HttpSession session) throws IOException {
<span class="fc" id="L694">        final List&lt;Usuarios&gt; listaDis = dao.listUsuarios(usuarion, contraseña);</span>

<span class="fc" id="L696">        int tipo = 0;</span>
<span class="fc bfc" id="L697" title="All 2 branches covered.">        for (Usuarios usuarios : listaDis) {</span>

<span class="fc" id="L699">            tipo += usuarios.getId_tipo_usuario();</span>
<span class="fc" id="L700">        }</span>

<span class="fc bfc" id="L702" title="All 2 branches covered.">        if (listaDis.size() &gt; 0) {</span>
<span class="fc" id="L703">            session.setAttribute(&quot;name&quot;, usuarion);</span>
<span class="fc" id="L704">            session2 = usuarion;</span>
<span class="fc" id="L705">            session.setAttribute(&quot;tipo&quot;, tipo);</span>

<span class="fc" id="L707">            return &quot;redirect:/&quot;;</span>

        } else {
<span class="fc" id="L710">            return &quot;redirect:/login?error=true&quot;;</span>
        }

    }

    /**
     * &lt;p&gt;
     * Método para verificación de usuarios
     * &lt;/p&gt;
     * 
     * @param usuarion   usuario que se ingresa
     * @param contraseña contraseña que se ingresa
     * @param session    sesion para logearse
     * @return Se manda el parametro de usuario y contraseña para que el sistema
     *         peuda validar si existe el usuario y que tipo de usuario es el que
     *         ingresara al sistema. Si no se encuentra el usuario dara una alerta
     *         de accesos denegado.
     */
    // Error
    /**
     * &lt;p&gt;
     * Método para mostrar error en el login
     * &lt;/p&gt;
     * 
     * @param model para mostrar el html
     * @param error para mostrar error en el html
     * @return Se retornara en la pagina html del login si existe un error a la hora
     *         de ingresar al sistema de ventas.
     */
    @RequestMapping(&quot;/login?{error}&quot;)
    public String verLoginE(final Model model, @PathVariable(&quot;error&quot;) String error) {

<span class="nc" id="L742">        return &quot;login.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para restingir el acceso a las paginas html
     * 
     * @param model para mostrar el html
     * @return Se retornara en la pagina html diciendo que tiene acceso prohibido a
     *         esa pagina ya que no es un usuario permitido.
     */
    @RequestMapping(&quot;/accesoProhibido&quot;)
    public String accesoP(final Model model) {

<span class="nc" id="L756">        return &quot;accesoProhibido.html&quot;;</span>
    }

    // Pagina usuarios
    /**
     * &lt;p&gt;
     * Método para mostrar los usuarios
     * 
     * @param model para mostrar el html de usuarios
     * @return Se retornara en la pagina html todos los usuarios que existen en el
     *         sistema de ventas.
     */
    @RequestMapping(value = &quot;/usuarios&quot;)
    public String usuariosPag(final Model model) {
<span class="nc" id="L770">        final List&lt;Usuarios&gt; listU = dao.usuariosMostrar();</span>
<span class="nc" id="L771">        model.addAttribute(&quot;listU&quot;, listU);</span>
<span class="nc" id="L772">        return &quot;usuarios.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para actualizar un usuario
     * 
     * @param nuevo para mandar los usuarios actualizados
     * @return Se mandaran los datos del usuario que se estan actualizando en el
     *         sistema.
     */
    @RequestMapping(value = &quot;/updateUsuario&quot;, method = RequestMethod.POST)
    public String actualizarU(@ModelAttribute(&quot;user&quot;) Usuarios nuevo) throws IOException {

<span class="nc" id="L786">        dao.updateU(nuevo);</span>
<span class="nc" id="L787">        String tabla = &quot;Usuarios&quot;;</span>
<span class="nc" id="L788">        dao.historialC(session2, &quot;Update&quot;, tabla);</span>
<span class="nc" id="L789">        return &quot;redirect:/usuarios&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para eliminar un usuario
     * 
     * @param id para llamar el id del usuario que se selecciono
     * @return Se mandaran la operacion de eliminacion del usuario que fue
     *         seleccionado y se redireccionara a la pagina de usuarios ya con el
     *         usuario eliminado.
     */
    @RequestMapping(value = &quot;/eliminarUsuario&quot;, method = RequestMethod.POST)
    public String deleteU(@RequestParam(name = &quot;id_usuario&quot;) int id) throws IOException {

<span class="nc" id="L804">        dao.deleteUsuario(id);</span>
<span class="nc" id="L805">        String tabla = &quot;Usuarios&quot;;</span>
<span class="nc" id="L806">        dao.historialC(session2, &quot;Delete&quot;, tabla);</span>
<span class="nc" id="L807">        return &quot;redirect:/usuarios&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para salir del sistema
     * 
     * @param model   para mostrar el html
     * @param session para llamar a la sesion logeada
     * @return Se mandaran la pagina html del login cuando el usuario se deslogee
     *         del sistema de ventas.
     */
    @RequestMapping(&quot;/logoff&quot;)
    public String logoff(final Model model, HttpSession session) {
<span class="nc" id="L821">        session.invalidate();</span>
<span class="nc" id="L822">        return &quot;login.html&quot;;</span>
    }

    // Crear usuario
    /**
     * &lt;p&gt;
     * Método para insertar un usuario
     * 
     * @param nuevo para insertar un usuario
     * @return Se mandaran la pagina html donde se podra ingresar un nuevo ussuario
     *         al sistema de ventas para que tenga sus respectivos accesos.
     */
    @RequestMapping(value = &quot;/crearUsuario&quot;, method = RequestMethod.POST)
    public String createU(@ModelAttribute(&quot;userN&quot;) Usuarios nuevo) throws IOException {

<span class="nc" id="L837">        Base64.getEncoder().encodeToString(nuevo.getContraseña().getBytes(&quot;utf-8&quot;));</span>
<span class="nc" id="L838">        dao.crearU(nuevo);</span>
<span class="nc" id="L839">        String tabla = &quot;Usuarios&quot;;</span>
<span class="nc" id="L840">        dao.historialC(session2, &quot;Insert&quot;, tabla);</span>
<span class="nc" id="L841">        return &quot;redirect:/usuarios&quot;;</span>
    }

    // Mostrar historial
    /**
     * &lt;p&gt;
     * Método para ver historial de log
     * 
     * @param model para mostrar el html
     * @return Se mandaran la pagina html del historial de todas las operaciones que
     *         se han realizado en el sistema de ventas.
     */
    @RequestMapping(value = &quot;/cambios&quot;)
    public String cambiosP(final Model model) {
<span class="nc" id="L855">        final List&lt;Historial&gt; listC = dao.cambios();</span>
<span class="nc" id="L856">        model.addAttribute(&quot;listC&quot;, listC);</span>
<span class="nc" id="L857">        return &quot;cambios.html&quot;;</span>
    }

    // Borrar historial
    /**
     * &lt;p&gt;
     * Método para eliminar historial de log
     * &lt;/p&gt;
     * 
     * @return Se eliminara todo el historial de las operaciones que se realizaron
     *         en el sistema de ventas.
     */
    @RequestMapping(&quot;/eliminarH&quot;)
    public String eliminarhistorial() throws IOException {
<span class="nc" id="L871">        dao.historialBorrar();</span>
<span class="nc" id="L872">        dao.historialC(session2, &quot;Elimino historial&quot;, &quot;Historial&quot;);</span>
<span class="nc" id="L873">        return &quot;redirect:/cambios&quot;;</span>
    }

    // Dispositivos individuales
    /**
     * &lt;p&gt;
     * Método para mostrar los dispositvos individuales
     * &lt;/p&gt;
     * 
     * 
     * @param model para mostrar el html
     * @return Se mostrara la pagina html con los dato de los dispositivos
     *         individuales con su numero de serie.
     */
    @RequestMapping(value = &quot;/terminales&quot;)
    public String terminales(final Model model) {
<span class="nc" id="L889">        final List&lt;Telefono&gt; listT = dao.listTerminales();</span>
<span class="nc" id="L890">        model.addAttribute(&quot;listT&quot;, listT);</span>
<span class="nc" id="L891">        return &quot;terminales.html&quot;;</span>
    }

    // Bodega
    /**
     * &lt;p&gt;
     * Método para mostrar los dispositvos en bodega
     * &lt;/p&gt;
     * 
     * 
     * @param model para mostrar el html
     * @return Se mostrara la pagina html con los dispositivos en existencia en
     *         bodegas en el sistema de ventas.
     */
    @RequestMapping(value = &quot;/bodega&quot;)
    public String bodega(final Model model) {
<span class="nc" id="L907">        final List&lt;Telefono&gt; listT = dao.bodega();</span>
<span class="nc" id="L908">        model.addAttribute(&quot;listT&quot;, listT);</span>
<span class="nc" id="L909">        return &quot;bodega.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para eliminar los dispositvos en bodega
     * &lt;/p&gt;
     * 
     * @param id para llamar el id de los dispositivos que se selecciono
     * @return Se eliminara de bodegas los dispositivo que ya no estara en el
     *         sistema de ventas.
     */
    @RequestMapping(&quot;/eliminarT&quot;)
    public String eliminarB(@RequestParam(name = &quot;id_bodega&quot;) int id) throws IOException {
<span class="nc" id="L923">        dao.deleteT(id);</span>
<span class="nc" id="L924">        dao.historialC(session2, &quot;Delete&quot;, &quot;Bodega&quot;);</span>
<span class="nc" id="L925">        return &quot;redirect:/bodega&quot;;</span>
    }

    // Mostrar compras individuales
    /**
     * &lt;p&gt;
     * Método para compras individuales
     * &lt;/p&gt;
     * 
     * @param model para mostrar el html
     * @param id    para llamar el id de los clientes individuales
     * @return Se tendra en la pagina html de compras los dispositivos de un cliente
     *         individual que fueron comprados.
     */
    @RequestMapping(value = &quot;/compras/{id}&quot;, method = RequestMethod.GET)
    public String viewCompra(final Model model, @PathVariable(&quot;id&quot;) int id) {
<span class="nc" id="L941">        final List&lt;Pedido&gt; listC = dao.mostrarC(id);</span>
<span class="nc" id="L942">        model.addAttribute(&quot;listC&quot;, listC);</span>
<span class="nc" id="L943">        final List&lt;Pedido&gt; listaT = dao.total2(id);</span>
<span class="nc" id="L944">        model.addAttribute(&quot;listaT&quot;, listaT);</span>
<span class="nc" id="L945">        return &quot;compras.html&quot;;</span>
    }

    /**
     * &lt;p&gt;
     * Método para enviar correo de compras al credito
     * &lt;/p&gt;
     * 
     * @param model   para mostrar el html
     * @param id      para llamar de clientes
     * @param correoE para mandar los datos de compra al credito
     * @return Se tendra una pagina web donde se enviara un correo a los clientes
     *         que compraron dispositivos al credito para recordarles de su pago.
     */
    @RequestMapping(value = &quot;/reporte/{id}/{correo}&quot;, method = RequestMethod.GET)
    public String reporte(final Model model, @PathVariable(&quot;id&quot;) int id, @PathVariable(&quot;correo&quot;) String correoE) {
<span class="nc" id="L961">        final List&lt;Pedido&gt; listC = dao.mostrarC(id);</span>
<span class="nc" id="L962">        model.addAttribute(&quot;listC&quot;, listC);</span>
<span class="nc" id="L963">        final List&lt;Pedido&gt; listaT = dao.total2(id);</span>
<span class="nc" id="L964">        model.addAttribute(&quot;listaT&quot;, listaT);</span>

<span class="nc" id="L966">        String mensaje = &quot;Los dispositvos comprados este mes fueron: &quot;;</span>
<span class="nc" id="L967">        String mensajeT = &quot; '\n'El total de compras al credito es de: &quot;;</span>

<span class="nc bnc" id="L969" title="All 2 branches missed.">        for (Pedido pedido : listaT) {</span>
<span class="nc" id="L970">            mensajeT += pedido.getTotales();</span>
<span class="nc" id="L971">        }</span>
<span class="nc bnc" id="L972" title="All 2 branches missed.">        for (Pedido pedido : listC) {</span>
<span class="nc" id="L973">            mensaje += pedido.getNombret() + ',' + pedido.getCantidadp() + pedido.getCantidadp_a() + ',';</span>
<span class="nc" id="L974">        }</span>

<span class="nc" id="L976">        correo.sendMail(&quot;marcellinos777@gmail.com&quot;, correoE, &quot;Detalle&quot;, mensaje + mensajeT);</span>
<span class="nc" id="L977">        return &quot;compras.html&quot;;</span>
    }

    // Mostrar el board
    /**
     * &lt;p&gt;
     * Método para mostrar las marcas vendidas
     * &lt;/p&gt;
     * 
     * @param model para mostrar el html
     * @return Se tendra una pagina web donde se mostraran unas graficas con las
     *         marcas que fueron vendidas y cuantos dispositivos fueron vendidos en
     *         el sistema de ventas.
     */
    @RequestMapping(value = &quot;/board&quot;)
    public String board(final Model model) {
<span class="fc" id="L993">        final List&lt;Pedido&gt; listT = dao.board();</span>
<span class="fc" id="L994">        model.addAttribute(&quot;listT&quot;, listT);</span>

<span class="fc" id="L996">        List&lt;String&gt; marcas = new ArrayList&lt;String&gt;();</span>
<span class="fc" id="L997">        List&lt;Integer&gt; cantidad = new ArrayList&lt;Integer&gt;();</span>

<span class="pc bpc" id="L999" title="1 of 2 branches missed.">        for (Pedido cuenta : listT) {</span>
<span class="nc" id="L1000">            String nmarca = cuenta.getNombref();</span>
<span class="nc" id="L1001">            marcas.add(nmarca);</span>
<span class="nc" id="L1002">            cantidad.add(cuenta.getCantidad());</span>
<span class="nc" id="L1003">        }</span>
<span class="fc" id="L1004">        cantidad.add(0);</span>
<span class="fc" id="L1005">        model.addAttribute(&quot;marcas&quot;, marcas);</span>
<span class="fc" id="L1006">        model.addAttribute(&quot;cantidad&quot;, cantidad);</span>

<span class="fc" id="L1008">        return &quot;board.html&quot;;</span>
    }

    // REST
    /**
     * &lt;p&gt;
     * Método para mostrar los dispositvos de fabrica
     * &lt;/p&gt;
     * 
     * @param model para mostrar el html
     * @return Se tendra una pagina web donde se mostraran los dispositivos que
     *         venden la fabrica de alguna marca en especifico.
     */
    @RequestMapping(value = &quot;/getdispo&quot;, method = RequestMethod.GET)
    public String getDispo(final Model model) {
<span class="nc" id="L1023">        String uri = &quot;http://localhost:5000/api/dispositivos&quot;;</span>
<span class="nc" id="L1024">        RestTemplate restTemplate = new RestTemplate();</span>

<span class="nc" id="L1026">        ResponseEntity&lt;Dispositivo[]&gt; response = restTemplate.getForEntity(uri, Dispositivo[].class);</span>
<span class="nc" id="L1027">        Dispositivo[] employees = response.getBody();</span>
<span class="nc" id="L1028">        model.addAttribute(&quot;listaFD&quot;, employees);</span>
<span class="nc" id="L1029">        Telefono nuevo = new Telefono();</span>
<span class="nc" id="L1030">        model.addAttribute(&quot;nuevo&quot;, nuevo);</span>

<span class="nc" id="L1032">        return &quot;AAFabricaDispo.html&quot;;</span>
    }

    // Ir a fabrica
    /**
     * &lt;p&gt;
     * Método para insertar fabrica
     * &lt;/p&gt;
     * 
     * @param model para mostrar el html
     * @return Se tendra una pagina web para ingresar una nueva fabrica donde el
     *         sistema de ventas podra realizar compras.
     */
    @RequestMapping(value = &quot;/fabricas&quot;)
    public String fabricas(final Model model) {
<span class="nc" id="L1047">        Fabrica nuevo = new Fabrica();</span>
<span class="nc" id="L1048">        model.addAttribute(&quot;nuevo&quot;, nuevo);</span>
<span class="nc" id="L1049">        final List&lt;Fabrica&gt; listaDis = dao.listFabrica();</span>
<span class="nc" id="L1050">        model.addAttribute(&quot;listaF&quot;, listaDis);</span>

<span class="nc" id="L1052">        return &quot;Fabrica.html&quot;;</span>
    }

    // Guardar fabrica
    /**
     * &lt;p&gt;
     * Método para guardar fabrica
     * &lt;/p&gt;
     * 
     * @param nuevo para guardar los datos de la fabrica
     * @param model para mostrar el html
     * @return Se tendra una pagina web donde se guardaran las fabricas con las
     *         cuales el sistema de ventas puede interactuar.
     */
    @RequestMapping(value = &quot;/guardarFabrica&quot;, method = RequestMethod.POST)
    public String guardarFabri(final Model model, @ModelAttribute(&quot;nuevo&quot;) Fabrica nuevo) throws IOException {
<span class="nc" id="L1068">        dao.guardarFabrica(nuevo);</span>
<span class="nc" id="L1069">        Marca ma = new Marca();</span>

<span class="nc" id="L1071">        ma.setNombre_marca(nuevo.getNombref());</span>
<span class="nc" id="L1072">        dao.saveMarca(ma);</span>

<span class="nc" id="L1074">        return &quot;redirect:/fabricas&quot;;</span>
    }

<span class="fc" id="L1077">    String ip = &quot;&quot;;</span>
<span class="fc" id="L1078">    String puerto = &quot;&quot;;</span>
<span class="fc" id="L1079">    String url = &quot;&quot;;</span>

    // Conectar con fabrica
    /**
     * &lt;p&gt;
     * Método para conectar con una fabrica
     * &lt;/p&gt;
     * 
     * @param model para mostrar el html
     * @param id    para llamar el id de la fabrica
     * @return Se tendra una pagina web donde se conectara las fabricas para poder
     *         realizar un pedido.
     */
    @RequestMapping(value = &quot;/irFabrica/{id}&quot;, method = RequestMethod.GET)
    public String irFabrica(final Model model, @PathVariable(&quot;id&quot;) int id) {

<span class="nc" id="L1095">        final List&lt;Fabrica&gt; listaF = dao.getFab(id);</span>

<span class="nc bnc" id="L1097" title="All 2 branches missed.">        for (Fabrica fabrica : listaF) {</span>
<span class="nc" id="L1098">            ip = fabrica.getIp();</span>
<span class="nc" id="L1099">            puerto = fabrica.getPuerto();</span>

<span class="nc" id="L1101">        }</span>

<span class="nc" id="L1103">        final List&lt;Fabrica&gt; listaF2 = dao.getFab(id);</span>
<span class="nc" id="L1104">        int idmarca = 0;</span>
<span class="nc bnc" id="L1105" title="All 2 branches missed.">        for (Fabrica fabrica : listaF2) {</span>
<span class="nc" id="L1106">            idmarca += fabrica.getId_fabrica();</span>
<span class="nc" id="L1107">        }</span>
<span class="nc" id="L1108">        model.addAttribute(&quot;id_marca&quot;, idmarca);</span>

        // Para mostrar los dispositivos
<span class="nc" id="L1111">        String uri = &quot;http://&quot; + ip + &quot;:&quot; + puerto + &quot;/api/dispositivos&quot;;</span>
<span class="nc" id="L1112">        url = uri;</span>
<span class="nc" id="L1113">        RestTemplate restTemplate = new RestTemplate();</span>
<span class="nc" id="L1114">        ResponseEntity&lt;Telefono[]&gt; response = restTemplate.getForEntity(uri, Telefono[].class);</span>
<span class="nc" id="L1115">        Telefono[] employees = response.getBody();</span>
<span class="nc" id="L1116">        model.addAttribute(&quot;listaFD&quot;, employees);</span>
        // Para mostrar los clientes
<span class="nc" id="L1118">        String uri2 = &quot;http://&quot; + ip + &quot;:&quot; + puerto + &quot;/api/cliente&quot;;</span>
<span class="nc" id="L1119">        RestTemplate restTemplate2 = new RestTemplate();</span>
<span class="nc" id="L1120">        ResponseEntity&lt;Cliente[]&gt; response2 = restTemplate2.getForEntity(uri2, Cliente[].class);</span>
<span class="nc" id="L1121">        Cliente[] clientes = response2.getBody();</span>
<span class="nc" id="L1122">        model.addAttribute(&quot;listaC&quot;, clientes);</span>

<span class="nc" id="L1124">        Telefono nuevo = new Telefono();</span>
<span class="nc" id="L1125">        model.addAttribute(&quot;nuevo&quot;, nuevo);</span>

<span class="nc" id="L1127">        return &quot;AAFabricaDispo.html&quot;;</span>
    }


    /**
     * &lt;p&gt;
     * Método para eliminar una fabrica
     * &lt;/p&gt;
     * 
     * @param id para llamar el id de la fabrica
     * @return se enviara el parametro del id de la fabrica la cual fue seleccionada
     *         para eliminarla y redireccionara a la pagina de las fabricas sin la
     *         que fue eliminada.
     */
    @RequestMapping(value = &quot;/deletefab&quot;, method = RequestMethod.POST)
    public String deletefab(@RequestParam(name = &quot;id_fabrica&quot;) int id) throws IOException {
<span class="nc" id="L1143">        dao.deletefab(id);</span>

<span class="nc" id="L1145">        String tabla = &quot;Fabrica&quot;;</span>
<span class="nc" id="L1146">        dao.historialC(session2, &quot;Delete&quot;, tabla);</span>
<span class="nc" id="L1147">        return &quot;redirect:/fabricas&quot;;</span>
    }

    

    
      
    //TODO:Cambio   


       /**
         * &lt;p&gt;Este controlador es para hacer un pedidos al sistema de fabrica&lt;/p&gt;
         * @param nuevo el telefono a pedir
         * @param idu   el id del usuario que lo pidio
         * @param idd   el id de la terminal a pedir
         * @return la pagina a redireccionar 
      
        */    
        @RequestMapping(value = &quot;/savePD&quot;, method = RequestMethod.POST)
        public String savep(@ModelAttribute(&quot;nuevo&quot;) Telefono nuevo,@RequestParam(name=&quot;idu&quot;) String idu,@RequestParam(name=&quot;_idd&quot;) String idd)
                throws IOException {
            
            //dao.save(nuevo);

<span class="nc" id="L1171">            String uri = &quot;http://&quot; + ip +&quot;:&quot;+ puerto+ &quot;/api/pedidos/gios&quot;;</span>
<span class="nc" id="L1172">		    RestTemplate restTemplate = new RestTemplate();</span>

<span class="nc" id="L1174">		    Map&lt;String, String&gt; map = new HashMap&lt;&gt;();</span>
<span class="nc" id="L1175">            Date fecha = new Date(); </span>
<span class="nc" id="L1176">            SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy/MM/dd&quot;);</span>
<span class="nc" id="L1177">            String f = sdf.format(new Date());</span>

<span class="nc" id="L1179">            map.put(&quot;cantidad&quot;, String.valueOf(nuevo.getExistencia()));          </span>
<span class="nc" id="L1180">            map.put(&quot;fecha_p&quot;, f); </span>
<span class="nc" id="L1181">            map.put(&quot;dispositivo&quot;,idd);</span>
<span class="nc" id="L1182">            map.put(&quot;cliente&quot;,idu);              </span>
           
			  
<span class="nc" id="L1185">		    ResponseEntity&lt;Void&gt; response  = restTemplate.postForEntity(uri, map, Void.class);</span>
		
<span class="nc bnc" id="L1187" title="All 2 branches missed.">		if (response.getStatusCode() == HttpStatus.OK) {</span>
<span class="nc" id="L1188">			System.out.println(&quot;Request Successful&quot;);</span>
		} else {
<span class="nc" id="L1190">			System.out.println(&quot;Request Failed&quot;);</span>
		}
<span class="nc" id="L1192">		return &quot;redirect:/&quot;;</span>
            
    
    
        }

     



        /**
         * &lt;p&gt;Este controlador es para confirmar el pediod a fabrica&lt;/p&gt;
         * @param nuevo el telefono a confirmar 
         * @param idu   el id del usuario que lo confirmo 
         * @param idd   el id de la terminal a confirmar 
         * @param idp   el id del pedido a confirmar 
         * @return la pagina a redireccionar 
      
        */ 
        @RequestMapping(value = &quot;/savePD2&quot;)
        public String save2(@ModelAttribute(&quot;nuevo&quot;) Telefono nuevo,@RequestParam(name=&quot;idu&quot;) String idu,@RequestParam(name=&quot;_idd&quot;) String idd,@RequestParam(name=&quot;_idp&quot;) String idp,@RequestParam(name=&quot;listanum&quot;) List&lt;String&gt; num)
                throws IOException {
            
           
<span class="nc" id="L1216">                dao.save(nuevo);</span>
<span class="nc bnc" id="L1217" title="All 2 branches missed.">                    for (String string : num) {</span>
<span class="nc" id="L1218">                        String[] parts = string.split(&quot;/&quot;);</span>
<span class="nc bnc" id="L1219" title="All 2 branches missed.">                        if(!string.equals(&quot;1&quot;)){</span>
                            
<span class="nc" id="L1221">                            dao.saveNum(string,parts[0],dao.getlastID().getId_bodega());</span>
                            
                        }
                        
<span class="nc" id="L1225">                    }</span>
  

        

<span class="nc" id="L1230">            String uri = &quot;http://&quot; + ip +&quot;:&quot;+ puerto+ &quot;/api/pedidos/&quot; + idp;</span>
<span class="nc" id="L1231">		    RestTemplate restTemplate = new RestTemplate();</span>
<span class="nc" id="L1232">		    Map&lt;String, String&gt; map = new HashMap&lt;&gt;();       </span>
<span class="nc" id="L1233">            map.put(&quot;estado&quot;,&quot;Entregado&quot;);        </span>
  
           	
		  
<span class="nc" id="L1237">           Telefono wry = new Telefono();</span>
<span class="nc" id="L1238">           wry.setEstado(&quot;Entregado&quot;);</span>
            
		  

<span class="nc" id="L1242">		   restTemplate.put(uri, map);  </span>

           
		
<span class="nc" id="L1246">		return &quot;redirect:/&quot;;</span>
            
    
    
        }

    

         /**
         * &lt;p&gt;Este controlador es para visualizar los pedidos realizados a cada fabrica &lt;/p&gt;
         * @param model la representacion html 
         * @param id el id de la fabrica a consultar los pedidos       
         * @return la pagina a redireccionar 
      
        */        
        @RequestMapping(value = &quot;/pedidosF/{id}&quot;,method = RequestMethod.GET)
        public String   getPedidoF(final Model model,@PathVariable(&quot;id&quot;) int id)

        {

<span class="nc" id="L1266">            final List&lt;Fabrica&gt; listaF = dao.getFab(id); </span>
        
<span class="nc bnc" id="L1268" title="All 2 branches missed.">                for (Fabrica fabrica : listaF) {</span>
<span class="nc" id="L1269">                ip = fabrica.getIp();</span>
<span class="nc" id="L1270">                puerto = fabrica.getPuerto(); </span>
            
<span class="nc" id="L1272">                }</span>
<span class="nc" id="L1273">            final List&lt;Fabrica&gt; listaF2 = dao.getFab(id); </span>
<span class="nc" id="L1274">            int idmarca = 0; </span>
<span class="nc bnc" id="L1275" title="All 2 branches missed.">            for (Fabrica fabrica : listaF2) {</span>
<span class="nc" id="L1276">                idmarca += fabrica.getId_fabrica();</span>
<span class="nc" id="L1277">            }</span>
<span class="nc" id="L1278">            model.addAttribute(&quot;id_marca&quot;, idmarca);</span>
<span class="nc" id="L1279">            String con = ip +&quot;:&quot; + puerto; </span>
<span class="nc" id="L1280">            model.addAttribute(&quot;conexion&quot;, con);</span>


<span class="nc" id="L1283">                String uri = &quot;http://&quot; + ip +&quot;:&quot;+ puerto+ &quot;/api/pedidos&quot;;</span>
<span class="nc" id="L1284">                url = uri; </span>
<span class="nc" id="L1285">                RestTemplate restTemplate = new RestTemplate();   </span>
<span class="nc" id="L1286">                ResponseEntity&lt;Telefono[]&gt; response = restTemplate.getForEntity(uri,Telefono[].class);</span>
<span class="nc" id="L1287">                Telefono[] employees = response.getBody();	  </span>
<span class="nc" id="L1288">                model.addAttribute(&quot;listaFD&quot;, employees); </span>

                /*
                final List&lt;Telefono&gt; listaDis = dao.listPedidoF();
            
                model.addAttribute(&quot;listaFD&quot;, listaDis);  

        
                */


        
            
<span class="nc" id="L1301">                return &quot;FabricaControl.html&quot;;</span>
        }
    



    
         /**
         * &lt;p&gt;Este controlador es para confirmar a fabrica  &lt;/p&gt;
         * @deprecated
         * usado solo para hacer pruebas con la api
         * @param model la representacion html 
         * @param n el telefono que se guardo   
         * @return la pagina a redireccionar 
      
        */ 
        @RequestMapping(value = &quot;/updateEstadp&quot;)
        public String updateP(final Model model,@ModelAttribute(&quot;nuevo&quot;) Telefono n)

        {       
        
<span class="nc" id="L1322">            String uri = &quot;http://&quot; + ip +&quot;:&quot;+ puerto+ &quot;/api/pedidos/6074b74053f92e0fb4017181&quot;;</span>
<span class="nc" id="L1323">            RestTemplate restTemplate = new RestTemplate();</span>

<span class="nc" id="L1325">		    Map&lt;String, String&gt; map = new HashMap&lt;&gt;();</span>
           
<span class="nc" id="L1327">            map.put(&quot;Estado&quot;, &quot;Entregado&quot;);         </span>
        

            
		
<span class="nc" id="L1332">		    return &quot;a &quot;; </span>
		
		  

        }




        @RequestMapping(value = &quot;/devolucion&quot;)
        public String devolucion(final Model model,@RequestParam(name=&quot;ip&quot;) String ips,@RequestParam(name=&quot;puerto&quot;) String puertos,@RequestParam(name=&quot;series&quot;) String series)

        {       
<span class="nc" id="L1345">            String conexion =  &quot;&quot; + ips +&quot;:&quot; + puertos; </span>
            
<span class="nc" id="L1347">            model.addAttribute(&quot;conexion&quot;,conexion);</span>
<span class="nc" id="L1348">            model.addAttribute(&quot;series&quot;,series);</span>

<span class="nc" id="L1350">            return &quot;terminalIndividual.html&quot;;</span>
           
        }




        @RequestMapping(value = &quot;/devolver&quot;)
        public String devolver(final Model model,@RequestParam(name=&quot;conexion&quot;) String conexion,@RequestParam(name=&quot;serie&quot;) String num_series)

        {       
        
<span class="nc" id="L1362">            String uri = &quot;http://&quot; + conexion+ &quot;/api/serie/&quot;+num_series;</span>
<span class="nc" id="L1363">            RestTemplate restTemplate = new RestTemplate();</span>
<span class="nc" id="L1364">		    Map&lt;String, String&gt; map = new HashMap&lt;&gt;();           </span>
<span class="nc" id="L1365">            map.put(&quot;estado&quot;, &quot;Devuelto&quot;);         </span>

            
		
<span class="nc" id="L1369">            restTemplate.put(uri, map);  </span>
		
		  

		  
        
            
<span class="nc" id="L1376">            return &quot;redirect:/terminales&quot;;</span>
        }

     




   









    

   








}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>