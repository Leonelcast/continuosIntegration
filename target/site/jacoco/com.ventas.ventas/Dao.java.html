<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Dao.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ventas</a> &gt; <a href="index.source.html" class="el_package">com.ventas.ventas</a> &gt; <span class="el_source">Dao.java</span></div><h1>Dao.java</h1><pre class="source lang-java linenums">package com.ventas.ventas;

import java.io.IOException;
import java.sql.Date;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.data.jpa.repository.Query;
import org.springframework.http.ResponseEntity;
import org.springframework.jdbc.core.BeanPropertyRowMapper;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;
import org.springframework.web.client.RestTemplate;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.jdbc.core.namedparam.BeanPropertySqlParameterSource;
import org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;
import org.springframework.jdbc.core.simple.SimpleJdbcInsert;

/**
 * &lt;p&gt;Clase utilizada para crear los servicios que interactuan con la base de datos de oracle &lt;/p&gt;
 */
@Repository
public class Dao {
    /**
        *&lt;p&gt;Constructor de la clase dao &lt;/p&gt; 
    */
<span class="fc" id="L32">    public Dao(){</span>

<span class="fc" id="L34">    }</span>

    /**
        *&lt;p&gt;Inicializar el jdbcTemplate para generar las consultas &lt;/p&gt; 
    */
    @Autowired
    private JdbcTemplate jdbcTemplate;

    /**
        *&lt;p&gt;Constructor para inicializar los servicios de jdbc &lt;/p&gt; 
    */
<span class="nc" id="L45">    public Dao(JdbcTemplate jdbcTemplate) {</span>
<span class="nc" id="L46">        this.jdbcTemplate = jdbcTemplate;</span>
<span class="nc" id="L47">    }</span>


    //TODO: Método para el manejo de catalogo de terminales 

    /**
     * &lt;p&gt;Método para listar todas las terminales en la pagina de inicio &lt;/p&gt;
          * @return listaDis la lista con todos las terminales disponibles  
    */
    public List&lt;Telefono&gt; list() {
<span class="nc" id="L57">        String sql = &quot;select *from VENTAS.bodega inner join VENTAS.fabrica on origen = id_fabrica  where id_estados = 3 or id_estados = 4&quot;;</span>
<span class="nc" id="L58">        List&lt;Telefono&gt; listaDis = jdbcTemplate.query(sql, BeanPropertyRowMapper.newInstance(Telefono.class));</span>
<span class="nc" id="L59">        return listaDis;</span>

    }

     /**
     * &lt;p&gt;Método para listar las caracterizticas de solo una terminal&lt;/p&gt;
     * @param id es la llave primaria de cada terminal
     * @return listaIn es una lista con las caracterizticas del telefono con el id que se manda como parametro 
    */
    public List&lt;Telefono&gt; list2(int id) {
<span class="nc" id="L69">        String sql = &quot;select *from VENTAS.bodega inner join VENTAS.fabrica on origen = id_fabrica where id_bodega  = ?&quot;;</span>
<span class="nc" id="L70">        Object[] args = { id };</span>
<span class="nc" id="L71">        List&lt;Telefono&gt; listaIn = jdbcTemplate.query(sql, args, BeanPropertyRowMapper.newInstance(Telefono.class));</span>
<span class="nc" id="L72">        return listaIn;</span>

    }

    /**
     * &lt;p&gt;Método para obtener una terminal a manera de objeto &lt;/p&gt;
     * @param id es la llave primaria de cada terminal
     * @return nuevo objeto de tipo telefono 
    */    
    public Telefono get(int id) {
<span class="nc" id="L82">        String sql = &quot;SELECT * FROM VENTAS.Bodega where id_bodega = ?&quot;;</span>
<span class="nc" id="L83">        Object[] args = { id };</span>
<span class="nc" id="L84">        Telefono nuevo = jdbcTemplate.queryForObject(sql, args, BeanPropertyRowMapper.newInstance(Telefono.class));</span>
<span class="nc" id="L85">        return nuevo;</span>
    }

     /**
     * &lt;p&gt;Método para actualizar las fotos de las terminales &lt;/p&gt;
     * @deprecated
     * Este Método quedo desactualizado, se paso a manejar las imagenes con url 
     * @param foto son los bytes de la foto
     * @param consulta el string para generar la consulta para actualizar los dispositivos
     * @param id la llave primaria para ejectuar la consulta sobre un registro en particular
    */
    public void updateF(byte[] foto, String consulta, int id) {

<span class="nc bnc" id="L98" title="All 2 branches missed.">        if (foto.length &gt; 0) {</span>
<span class="nc" id="L99">            jdbcTemplate.update(consulta, foto, id);</span>

        }

<span class="nc" id="L103">    }</span>

    /**
     * &lt;p&gt;Método para actualizar los parametros de las terminales &lt;/p&gt;
     * @param nuevo objeto de tipo de telefono 
     * &lt;p&gt;Se utiliza el objeto completo para actualizar todos los campos&lt;/p&gt;
     * &lt;b&gt;Es importante usar  '=:' para actualizar los campos y no dejar espacios&lt;/b&gt;
    */  
    public void updateT(Telefono nuevo) {
<span class="nc" id="L112">        String sql = &quot;UPDATE VENTAS.BODEGA SET existencia=:existencia , precio_lista=:precio_lista, codigo_modelo=:codigo_modelo, ram=:ram, almacenamiento=:almacenamiento, procesador=:procesador, numero_cores=:numero_cores,color=:color,descripcion=:descripcion,nombret=:nombret,origen=origen,foto1=:foto1,foto2=:foto2,foto3=:foto3 WHERE id_bodega=:id_bodega&quot;;</span>
<span class="nc" id="L113">        BeanPropertySqlParameterSource param = new BeanPropertySqlParameterSource(nuevo);</span>

<span class="nc" id="L115">        NamedParameterJdbcTemplate template = new NamedParameterJdbcTemplate(jdbcTemplate);</span>
<span class="nc" id="L116">        template.update(sql, param);        </span>

<span class="nc" id="L118">    }</span>

     /**
     * &lt;p&gt;Método para crear nuevas terminales&lt;/p&gt;
     * @param nuevo objeto de tipo de telefono, que es la terminal a guardar  
     * @throws IOException
     * &lt;p&gt; Los insert a la base de datos son manejados por el jdbctemplate que ejecuta la consulta&lt;/p&gt;
      */ 
    public void save(Telefono nuevo) throws IOException { 

<span class="nc" id="L128">        SimpleJdbcInsert insertActor = new SimpleJdbcInsert(jdbcTemplate);</span>
<span class="nc" id="L129">        insertActor.withSchemaName(&quot;VENTAS&quot;).withTableName(&quot;BODEGA&quot;).usingColumns( &quot;existencia&quot;,</span>
                &quot;precio_lista&quot;, &quot;codigo_modelo&quot;, &quot;ram&quot;, &quot;almacenamiento&quot;, &quot;procesador&quot;, &quot;numero_cores&quot;, &quot;color&quot;,
                &quot;descripcion&quot;, &quot;nombret&quot;,&quot;origen&quot;,&quot;id_estados&quot;,&quot;foto1&quot;,&quot;foto2&quot;,&quot;foto3&quot;);
<span class="nc" id="L132">        BeanPropertySqlParameterSource param = new BeanPropertySqlParameterSource(nuevo);</span>

<span class="nc" id="L134">        insertActor.execute(param);    </span>
<span class="nc" id="L135">    }</span>

    /**
     * &lt;p&gt;Método ara salvar los numeros de serie&lt;/p&gt;
     * @param consulta  objeto de tipo de telefono, que es la terminal a guardar  
     * &lt;p&gt; Los insert a la base de datos son manejados por el jdbctemplate que ejecuta la consulta&lt;/p&gt;
      */ 
      public void saveNum(String num,String modelo,int id) {
<span class="nc" id="L143">        String sql = &quot;insert into ventas.numeros_serie(num_series,modelo,id_bodega) values(?,?,?) &quot;;</span>
<span class="nc" id="L144">        jdbcTemplate.update(sql, num,modelo,id);</span>

 
       
   

        

<span class="nc" id="L152">    }</span>

        /**
     * &lt;p&gt;Obtner el id de la bodega&lt;/p&gt; 
     * &lt;p&gt; Los insert a la base de datos son manejados por el jdbctemplate que ejecuta la consulta&lt;/p&gt;
      */
      public Telefono getlastID() {
<span class="nc" id="L159">        String sql = &quot;select *from ventas.bodega order by id_bodega desc FETCH FIRST 1 ROWS ONLY &quot;;</span>
<span class="nc" id="L160">        Telefono registro = jdbcTemplate.queryForObject(sql, BeanPropertyRowMapper.newInstance(Telefono.class));</span>
<span class="nc" id="L161">        return registro;</span>
    } 
      







     /**
     * &lt;p&gt;Método para eliminar terminales&lt;/p&gt;
     * @param id el identificador para eliminar especificamente una terminal   
     * &lt;p&gt;A través del jdbcTemplate ejecutamos un update que ejecuta el delete&lt;/p&gt;     
    */ 
    public void delete(int id) {
<span class="nc" id="L177">        String sql = &quot;DELETE FROM VENTAS.BODEGA WHERE id_bodega = ?&quot;;</span>
<span class="nc" id="L178">        jdbcTemplate.update(sql, id);</span>
<span class="nc" id="L179">    }</span>

    /**
     * &lt;p&gt;Método para retornar una lista con opciones del tipo de telefono, usado principalemente en el combobox de marcas&lt;/p&gt;
     * @param query es la consulta que generamos para traer las opciones  
     * @return listaOpciones una lista con las marcas de telefonos 
     * &lt;p&gt;Este método puede devolver una lista de cualquier cosa que este definida dentro de la clase telefono&lt;/p&gt;
     */ 
    public List&lt;Telefono&gt; listOpciones(String query) {
<span class="nc" id="L188">        String sql = query;</span>

<span class="nc" id="L190">        List&lt;Telefono&gt; listaOpciones = jdbcTemplate.query(sql, BeanPropertyRowMapper.newInstance(Telefono.class));</span>
<span class="nc" id="L191">        return listaOpciones;</span>

    }


  


    /**
     * &lt;p&gt;Método para realizar una busqueda de terminales&lt;/p&gt;
     * @param buscar la cadena de texto que recibe para hacer la busqueda   
     * @return listaBusqueda es una lista de tipo telefono que retorna todos las terminales que cumplan con el criterio de busqueda
     
    */ 
    public List&lt;Telefono&gt; listBus(String buscar) {
<span class="fc" id="L206">        String sql = &quot;select *from VENTAS.bodega where nombret like ?   &quot;;</span>
<span class="fc" id="L207">        Object[] args = { buscar };</span>
<span class="fc" id="L208">        List&lt;Telefono&gt; listaBusqueda = jdbcTemplate.query(sql, args, BeanPropertyRowMapper.newInstance(Telefono.class));</span>
<span class="fc" id="L209">        return listaBusqueda;</span>

    }

     /**
     * &lt;p&gt;Método para borrar terminal de la bodega&lt;/p&gt;
     * @param id identificador de la terminal a eliminar
     
     
    */ 
    public void deleteT(int id) {
<span class="nc" id="L220">        String sql = &quot;DELETE FROM VENTAS.bodega WHERE id_bodega = ?&quot;;</span>
<span class="nc" id="L221">        jdbcTemplate.update(sql, id);</span>
<span class="nc" id="L222">    }</span>

    /**
     * &lt;p&gt;Método para mostrar dispositivos de bodega&lt;/p&gt;
     * @return terminalList la lista de tipo telefono con todas las terminales de bodega
     
     
    */ 
    public List&lt;Telefono&gt; bodega() {
<span class="nc" id="L231">        String sql = &quot;select *from ventas.bodega&quot;;</span>
<span class="nc" id="L232">        List&lt;Telefono&gt;    terminalList = jdbcTemplate.query(sql, BeanPropertyRowMapper.newInstance(Telefono.class));</span>
<span class="nc" id="L233">        return   terminalList;</span>

    }



    //TODO: Métodos para el manejo del cátalgo de clientes 

  /**
     * &lt;p&gt;Método para listar todos los clientes dentro de la base de datos, quitando el registro de cliente individual&lt;/p&gt;
     * @return listCli lista del tipo Cliente. 
     
    */ 
    public List&lt;Cliente&gt; listaCliente() {
<span class="nc" id="L247">        String sql = &quot;select * from ventas.clientes where id_cliente != '1' and id_cliente  != 2&quot;;</span>
<span class="nc" id="L248">        List&lt;Cliente&gt; listCli = jdbcTemplate.query(sql, BeanPropertyRowMapper.newInstance(Cliente.class));</span>
<span class="nc" id="L249">        return listCli;</span>
    }

     /**
     * &lt;p&gt;Método para retornar una lista con opciones del tipo de cliente, usado principalemente para traer los tipos de clientes&lt;/p&gt;
     * @param query es la consulta que generamos para traer las opciones  
     * @return una lista de opcioens para el tipo de cliente
     * &lt;p&gt;Este método puede devolver una lista de cualquier cosa que este definida dentro de la clase cliente&lt;/p&gt;
     
    */ 
    public List&lt;Cliente&gt; listOpcionesC(String query) {
<span class="nc" id="L260">        String sql = query;</span>

<span class="nc" id="L262">        List&lt;Cliente&gt; listaOpcionesC = jdbcTemplate.query(sql, BeanPropertyRowMapper.newInstance(Cliente.class));</span>
<span class="nc" id="L263">        return listaOpcionesC;</span>

    }

     /**
     * &lt;p&gt;Método salvar info de un cliente dentro de la bd&lt;/p&gt;
     * @param ci objeto de tipo cliente, es el que se guarda dentro de la bd   
     
     
    */     
    public void saveCliente(Cliente ci) {
<span class="nc" id="L274">        SimpleJdbcInsert insertActor = new SimpleJdbcInsert(jdbcTemplate);</span>
<span class="nc" id="L275">        insertActor.withSchemaName(&quot;VENTAS&quot;).withTableName(&quot;CLIENTES&quot;).usingColumns(&quot;nombre&quot;, &quot;apellido&quot;,&quot;nit&quot;, &quot;correo&quot;,  &quot;inicio_suscripcion&quot;, &quot;vencimiento_suscripcion&quot;,&quot;id_tipo_cliente&quot;,&quot;patente_comercio&quot;);</span>
<span class="nc" id="L276">        BeanPropertySqlParameterSource param = new BeanPropertySqlParameterSource(ci);</span>
<span class="nc" id="L277">        insertActor.execute(param);</span>
<span class="nc" id="L278">    }</span>


    /**
     * &lt;p&gt;Método para eliminar el cliente con el id&lt;/p&gt;
     * @param id identificador del cliente a borrar 

     
    */    
    public void deletecliente(int id) {
<span class="nc" id="L288">        String sql = &quot;DELETE FROM VENTAS.CLIENTES WHERE id_cliente = ?&quot;;</span>
<span class="nc" id="L289">        jdbcTemplate.update(sql, id);</span>
<span class="nc" id="L290">    }</span>

    /**
     * &lt;p&gt;Método para actualizar la info del cliente dentro de la bd&lt;/p&gt;
     * @param ci identificador del cliente a actualizar    
     
    */ 
    public void updateC(Cliente ci) {
<span class="nc" id="L298">        String sql = &quot;UPDATE VENTAS.CLIENTES SET  nombre=:nombre, apellido=:apellido,nit=:nit,correo=:correo, inicio_suscripcion=:inicio_suscripcion, vencimiento_suscripcion=:vencimiento_suscripcion,patente_comercio=:patente_comercio ,id_tipo_cliente=:id_tipo_cliente WHERE id_cliente=:id_cliente&quot;;</span>
<span class="nc" id="L299">        BeanPropertySqlParameterSource param = new BeanPropertySqlParameterSource(ci);</span>

<span class="nc" id="L301">        NamedParameterJdbcTemplate template = new NamedParameterJdbcTemplate(jdbcTemplate);</span>
<span class="nc" id="L302">        template.update(sql, param);</span>
<span class="nc" id="L303">    }</span>

    /**
     * &lt;p&gt;Método para obtener el objeto de un cliente en particular&lt;/p&gt;
     * @param id identificador del cliente a consultar 
     * @return ci el objeto cliente del respectivo id
     
    */ 
    public Cliente getC(int id) {
<span class="nc" id="L312">        String sql = &quot;SELECT * FROM VENTAS.CLIENTES WHERE id_cliente = ?&quot;;</span>
<span class="nc" id="L313">        Object[] args = { id };</span>
<span class="nc" id="L314">        Cliente ci = jdbcTemplate.queryForObject(sql, args, BeanPropertyRowMapper.newInstance(Cliente.class));</span>
<span class="nc" id="L315">        return ci;</span>

    }

    /**
     * &lt;p&gt;Método para obtener una lista con la info del cliente individual/&lt;p&gt;
     * @param id identificador del cliente a consultar 
     *  @return una lista de tipo cliente con la info del cliente especifico     
     
    */ 
    public List&lt;Cliente&gt; listaCliente2(int id) {
<span class="nc" id="L326">        String sql = &quot;select * from ventas.clientes where id_cliente = ?&quot;;</span>
<span class="nc" id="L327">        Object[] args = { id };</span>
<span class="nc" id="L328">        List&lt;Cliente&gt; listasC = jdbcTemplate.query(sql, args, BeanPropertyRowMapper.newInstance(Cliente.class));</span>
<span class="nc" id="L329">        return listasC;</span>

    }
    
    
    
    //TODO:Manejo de las marcas
    /**
     * @deprecated
     * &lt;p&gt;Las marcas pasamos a manejarlas con las fabricas&lt;/p&gt;
     * @return una lista con las marcas
     
    */ 
    public List&lt;Marca&gt; listMarca() {
<span class="nc" id="L343">        String sql = &quot;select * from VENTAS.marca_dispositivo&quot;;</span>
<span class="nc" id="L344">        List&lt;Marca&gt; listMar = jdbcTemplate.query(sql, BeanPropertyRowMapper.newInstance(Marca.class));</span>
<span class="nc" id="L345">        return listMar;</span>
    }

    /**
     * @deprecated
     * @param id unid especifoc de la marca
     * @return lista con las marcas
     * &lt;p&gt;Las marcas pasamos a manejarlas con las fabricas&lt;/p&gt;
     
    */ 
    public List&lt;Marca&gt; listMar2(int id) {
<span class="nc" id="L356">        String sql = &quot;select * from VENTAS.marca_dispositivo where id_marca = ?&quot;;</span>
<span class="nc" id="L357">        Object[] args = { id };</span>
<span class="nc" id="L358">        List&lt;Marca&gt; listMar = jdbcTemplate.query(sql, args, BeanPropertyRowMapper.newInstance(Marca.class));</span>
<span class="nc" id="L359">        return listMar;</span>

    }
    /**
     * @deprecated
     * &lt;p&gt;Las marcas pasamos a manejarlas con las fabricas&lt;/p&gt;
    */ 
    public void saveMarca(Marca ma) {
<span class="nc" id="L367">        SimpleJdbcInsert insertActor = new SimpleJdbcInsert(jdbcTemplate);</span>
<span class="nc" id="L368">        insertActor.withSchemaName(&quot;VENTAS&quot;).withTableName(&quot;MARCA_DISPOSITIVO&quot;).usingColumns(&quot;nombre_marca&quot;);</span>
<span class="nc" id="L369">        BeanPropertySqlParameterSource param = new BeanPropertySqlParameterSource(ma);</span>

<span class="nc" id="L371">        insertActor.execute(param);</span>
<span class="nc" id="L372">    }</span>
    /**
     * @deprecated
     * &lt;p&gt;Las marcas pasamos a manejarlas con las fabricas&lt;/p&gt;
     
    */ 
    public void deleteMarca(int id) {
<span class="nc" id="L379">        String sql = &quot;DELETE FROM VENTAS.marca_dispositivo WHERE id_marca = ?&quot;;</span>
<span class="nc" id="L380">        jdbcTemplate.update(sql, id);</span>
<span class="nc" id="L381">    }</span>
    /**
     * @deprecated
     * &lt;p&gt;Las marcas pasamos a manejarlas con las fabricas&lt;/p&gt;
     
    */ 
    public void updateMarca(Marca ma) {
<span class="nc" id="L388">        String sql = &quot;UPDATE VENTAS.marca_dispositivo SET  nombre_marca=:nombre_marca WHERE id_marca=:id_marca&quot;;</span>
<span class="nc" id="L389">        BeanPropertySqlParameterSource param = new BeanPropertySqlParameterSource(ma);</span>

<span class="nc" id="L391">        NamedParameterJdbcTemplate template = new NamedParameterJdbcTemplate(jdbcTemplate);</span>

<span class="nc" id="L393">        template.update(sql, param);</span>

<span class="nc" id="L395">    }</span>


    //TODO: Métodos para el manejo de pedidos 

    /**
         * &lt;p&gt;Método para insertar un pedido realizado por algun cliente &lt;/p&gt;
         * @param nuevo es el objeto de tipo Pedido con la info a guardar 
         * @throws IOException

         
    */ 
    public void insertarPedido(Pedido nuevo) throws IOException { 
<span class="nc" id="L408">        SimpleJdbcInsert insertActor = new SimpleJdbcInsert(jdbcTemplate);</span>
<span class="nc" id="L409">        insertActor.withSchemaName(&quot;VENTAS&quot;).withTableName(&quot;PEDIDO&quot;).usingColumns( &quot;ID_CLIENTE&quot;,&quot;CANTIDADP&quot;, &quot;CANTIDADP_A&quot;,&quot;ID_BODEGA&quot;,&quot;TOTAL_C&quot;);</span>
<span class="nc" id="L410">        BeanPropertySqlParameterSource param = new BeanPropertySqlParameterSource(nuevo);</span>
<span class="nc" id="L411">        insertActor.execute(param);    </span>
<span class="nc" id="L412">    }</span>

    /**
         * @deprecated
         * ya no se uso para obtener el id de un cliente en especifico 
         * &lt;p&gt;Obtener info de un cliente en particular &lt;/p&gt;
         *@param nit se pasa para obtener la info de un cliente en especifico 
         
    */ 
    public List&lt;Cliente&gt; idCliente(int nit) {
<span class="nc" id="L422">        String sql = &quot;select id_cliente from ventas.clientes where nit = ?&quot;;</span>
<span class="nc" id="L423">        Object[] args = { nit };</span>
<span class="nc" id="L424">        List&lt;Cliente&gt; idC = jdbcTemplate.query(sql, args, BeanPropertyRowMapper.newInstance(Cliente.class));</span>
<span class="nc" id="L425">        return idC;</span>
    }


    /**
         * &lt;p&gt;Obtener info de un cliente  &lt;/p&gt;
         *@param nit para obtener info de un cliente en particular 
         
    */ 
    public List&lt;Cliente&gt; clienteNit(int nit) {
<span class="fc" id="L435">        String sql = &quot;select * from ventas.clientes where nit = ?&quot;;</span>
<span class="fc" id="L436">        Object[] args = { nit };</span>
<span class="fc" id="L437">        List&lt;Cliente&gt; idCn = jdbcTemplate.query(sql, args, BeanPropertyRowMapper.newInstance(Cliente.class));</span>
<span class="fc" id="L438">        return idCn;</span>

    }

     /**
         * &lt;p&gt;Confirmar las terminales pedidas por un cliente  &lt;/p&gt;
         *@param id el identificador de la persona que realiza el pedido 
         @param cred si el pedido se realizara al credito 
         
    */    
    public void facturar(int id,int cred) {
<span class="nc" id="L449">        String sql = &quot;UPDATE VENTAS.pedido SET credito = ? where id_cliente = ? and compra != 1  &quot;;</span>
<span class="nc" id="L450">        jdbcTemplate.update(sql,cred,id);</span>

<span class="nc" id="L452">    }</span>

    /**
         * &lt;p&gt;Mostrar las terminales añadidas a un pedido  &lt;/p&gt;
         *@param id el identificador del cliente al que pertence el carro 
         
    */ 
    public List&lt;Pedido&gt; mostrarCarro(int id) {
        

<span class="fc" id="L462">        String sql = &quot;select *from ventas.bodega inner join ventas.pedido using(id_bodega) where id_cliente = ? and compra != 1&quot;;</span>
<span class="fc" id="L463">        Object[] args = { id };</span>
<span class="fc" id="L464">        List&lt;Pedido&gt; listaC = jdbcTemplate.query(sql,args, BeanPropertyRowMapper.newInstance(Pedido.class));</span>
<span class="fc" id="L465">        return listaC;</span>

    }


    /**
         * &lt;p&gt;Mostrar la factura del pedido que se esta realizando   &lt;/p&gt;
         *@param id identificador del cliente a mostrar factura 
         
    */ 
    public List&lt;Pedido&gt; mostrarFactura(int id) {
        

<span class="fc" id="L478">        String sql = &quot;select (ventas.precio(id_tipo_cliente,id_bodega)*(cantidadp+cantidadp_a)) as precio_total, b.* from(  select  *from ventas.clientes inner join(    select *from ventas.bodega inner join ventas.pedido using(id_bodega) )a  using(id_cliente))b where id_cliente = ? and compra =0 &quot;;</span>
<span class="fc" id="L479">        Object[] args = { id };</span>
<span class="fc" id="L480">        List&lt;Pedido&gt; listaF = jdbcTemplate.query(sql,args,  BeanPropertyRowMapper.newInstance(Pedido.class));</span>
<span class="fc" id="L481">        return listaF;</span>

    }
   
    /**
         * &lt;p&gt;Mostrar el total de la compra   &lt;/p&gt;
         *@param id total de la compra de un cliente en especifico
         
    */ 
    public List&lt;Pedido&gt; total(int id) {
        

<span class="fc" id="L493">        String sql = &quot;select sum(total) as totales  from(select (ventas.precio(id_tipo_cliente,id_bodega)*(cantidadp+cantidadp_a)) as total, b.* from(select  *from ventas.clientes inner join( select *from ventas.bodega inner join ventas.pedido using(id_bodega) )a  using(id_cliente))b)c where id_cliente = ? and compra = 0 &quot;;</span>
<span class="fc" id="L494">        Object[] args = { id };</span>
<span class="nc" id="L495">        List&lt;Pedido&gt; listaT = jdbcTemplate.query(sql, args, BeanPropertyRowMapper.newInstance(Pedido.class));</span>
<span class="nc" id="L496">        return listaT;</span>

    }


    /**
         * &lt;p&gt;Mostrar el total de la compra una vez confirmada  &lt;/p&gt;
         *@param id total de la compra de un cliente en especifico
         
    */ 
    public List&lt;Pedido&gt; total2(int id) {
        

<span class="nc" id="L509">        String sql = &quot;select sum(total) as totales  from(select (ventas.precio(id_tipo_cliente,id_bodega)*(cantidadp+cantidadp_a)) as total, b.* from(select  *from ventas.clientes inner join( select *from ventas.bodega inner join ventas.pedido using(id_bodega) )a  using(id_cliente))b)c where id_cliente = ? and compra = 1 &quot;;</span>
<span class="nc" id="L510">        Object[] args = { id };</span>
<span class="nc" id="L511">        List&lt;Pedido&gt; listaT = jdbcTemplate.query(sql, args, BeanPropertyRowMapper.newInstance(Pedido.class));</span>
<span class="nc" id="L512">        return listaT;</span>

    }
    
    /**
         * &lt;p&gt;Eliminar un pedido añadido al carro  &lt;/p&gt;
         *@param id identificador del pedido a eliminar 
         
    */
    public void deletePedido(int id) {
<span class="nc" id="L522">        String sql = &quot;DELETE FROM VENTAS.pedido where id_pedido = ?&quot;;</span>
<span class="nc" id="L523">        jdbcTemplate.update(sql, id);</span>
<span class="nc" id="L524">    }</span>

    /**
         * &lt;p&gt;Confirmar las compras &lt;/p&gt;
         *@param id identificador del cliente que realiza la compra 
         *Este metodo es importante porque es el que le indica al trigger que entre en funcionamiento 
         
    */
    public void comprarT(int id) {
<span class="nc" id="L533">        String sql = &quot;update ventas.pedido set id_estado = 2 , compra = 1 where id_cliente = ? and compra = 0&quot;;</span>
<span class="nc" id="L534">        jdbcTemplate.update(sql, id);</span>

<span class="nc" id="L536">        String sql2 = &quot;update ventas.pedido set descontado = 1 where id_cliente = ?&quot;;</span>
<span class="nc" id="L537">        jdbcTemplate.update(sql2, id);</span>

<span class="nc" id="L539">    }</span>








   
    //TODO: Manejo de usuarios 
  
    /**
         * &lt;p&gt;Método para obtener info de un usuario &lt;/p&gt;
         * @param usuario el usuario que ingresa 
         * @param contraseña la contraseña que ingresa 
         
    */ 
    public List&lt;Usuarios&gt; listUsuarios( String usuario,String contraseña) {
        

<span class="fc" id="L560">        String sql = &quot;select *from VENTAS.USUARIO where usuario = ? and contraseña = ?&quot;;</span>
<span class="fc" id="L561">        Object[] args = { usuario,contraseña };</span>
<span class="fc" id="L562">        List&lt;Usuarios&gt; listaU = jdbcTemplate.query(sql, args, BeanPropertyRowMapper.newInstance(Usuarios.class));</span>
<span class="fc" id="L563">        return listaU;</span>

    }

    /**
         * &lt;p&gt;Método mostrar a todos los usuarios dentro de la base de datos &lt;/p&gt;
         *@return listaU una lista de tipo Usuarios con todos los usuarios y su info
         
    */ 
    public List&lt;Usuarios&gt; usuariosMostrar() {
        

<span class="nc" id="L575">        String sql = &quot;select *from VENTAS.usuario inner join VENTAS.tipo_usuario using(id_tipo_usuario)&quot;;</span>
      
<span class="nc" id="L577">        List&lt;Usuarios&gt; listaU = jdbcTemplate.query(sql,  BeanPropertyRowMapper.newInstance(Usuarios.class));</span>
<span class="nc" id="L578">        return listaU;</span>

    }

     /**
        * @deprecated
         * &lt;p&gt;Método utilizado para listar usuarios&lt;/p&gt;
         *@return una lista de tipo usuario 
         
    */ 
    public List&lt;Usuarios&gt; getUsuarioporNombre() {
        

<span class="nc" id="L591">        String sql = &quot;select *from VENTAS.usuario inner join VENTAS.tipo_usuario using(id_tipo_usuario) where nombre = ?&quot;;      </span>
<span class="nc" id="L592">        List&lt;Usuarios&gt; listaU = jdbcTemplate.query(sql,  BeanPropertyRowMapper.newInstance(Usuarios.class));</span>
<span class="nc" id="L593">        return listaU;</span>

    }

   

    /**
         * &lt;p&gt;Método para actualizar un usuario&lt;/p&gt;
         * @param nuevo objeto tipo usuario que manda las actualizaciones
         
    */ 
    public void updateU(Usuarios nuevo) {
<span class="nc" id="L605">        String sql = &quot;UPDATE VENTAS.usuario SET usuario=:usuario , id_tipo_usuario=:id_tipo_usuario WHERE id_usuario=:id_usuario&quot;;</span>
<span class="nc" id="L606">        BeanPropertySqlParameterSource param = new BeanPropertySqlParameterSource(nuevo);</span>

<span class="nc" id="L608">        NamedParameterJdbcTemplate template = new NamedParameterJdbcTemplate(jdbcTemplate);</span>
<span class="nc" id="L609">        template.update(sql, param);</span>

        

<span class="nc" id="L613">    }</span>

    /**
         * &lt;p&gt;Método para eliminar un usuario especifico&lt;/p&gt;
         * @param id es el identificador para eliminar el usuario en especifico 
         
    */ 
    public void deleteUsuario(int id) {
<span class="nc" id="L621">        String sql = &quot;DELETE FROM VENTAS.usuario WHERE id_usuario = ?&quot;;</span>
<span class="nc" id="L622">        jdbcTemplate.update(sql, id);</span>
<span class="nc" id="L623">    }</span>

     /**
         * &lt;p&gt;Método para crear usuarios dentro del sistema de ventas&lt;/p&gt;
         * @param  nuevo objeto de tipo usuario 
         *  @throws IOException
         
    */ 
    public void crearU(Usuarios nuevo) throws IOException {

  

<span class="nc" id="L635">        SimpleJdbcInsert insertActor = new SimpleJdbcInsert(jdbcTemplate);</span>
<span class="nc" id="L636">        insertActor.withSchemaName(&quot;VENTAS&quot;).withTableName(&quot;USUARIO&quot;).usingColumns( &quot;usuario&quot;,&quot;contraseña&quot;,&quot;id_tipo_usuario&quot;);</span>
<span class="nc" id="L637">        BeanPropertySqlParameterSource param = new BeanPropertySqlParameterSource(nuevo);</span>
<span class="nc" id="L638">        insertActor.execute(param);</span>
<span class="nc" id="L639">     }</span>

 

  

 //TODO: Manejo del historial 

    /**
         * &lt;p&gt;Método para mostrar los cambios realizados&lt;/p&gt;
         * @return una lista con los cambios de tipo Historial 
         
         * 
    */ 
    public List&lt;Historial&gt; cambios() {
<span class="nc" id="L654">        String sql = &quot;select *from ventas.historial order by fecha_cambio desc&quot;;</span>
<span class="nc" id="L655">        List&lt;Historial&gt; listaDis = jdbcTemplate.query(sql, BeanPropertyRowMapper.newInstance(Historial.class));</span>
<span class="nc" id="L656">        return listaDis;</span>

    }

     /**
         * &lt;p&gt;Método para eliminiar el historial, solo queda guardado cuando fue la ultima vez que se elimino&lt;/p&gt;
         * @throws IOException        
    */ 
    public void historialBorrar() throws IOException {
<span class="nc" id="L665">        String sql = &quot;delete from ventas.historial where cambio != 'Elimino historial'&quot;;</span>
<span class="nc" id="L666">        jdbcTemplate.update(sql);</span>
<span class="nc" id="L667">    }</span>

    /**
         * &lt;p&gt;Método insertar cambios al historial&lt;/p&gt;
         * @param  usuario quien realizo el cambio
         *  @param cambio que cambio realizo 
         * @param tabla en que se realizo el cambio
         * @throws IOException
    */ 
    public void historialC(String usuario,String cambio, String tabla) throws IOException {
<span class="nc" id="L677">        String sql = &quot;insert into ventas.historial(usuario,cambio,tabla,fecha_cambio) values(?,?,?, cast(current_date as timestamp) at time zone 'UTC')&quot;;</span>
<span class="nc" id="L678">        jdbcTemplate.update(sql, usuario,cambio,tabla);  </span>

<span class="nc" id="L680">      }</span>

    /**
         * &lt;p&gt;Método para mostrar dispositivos de una vista&lt;/p&gt;
         * @return una lista de tipo de telefono resultado de consultar una vista       
    */ 
    public List&lt;Telefono&gt; listTerminales() {
<span class="nc" id="L687">        String sql = &quot;select *from VENTAS.VIEW2&quot;;</span>
<span class="nc" id="L688">        List&lt;Telefono&gt; listaDis = jdbcTemplate.query(sql, BeanPropertyRowMapper.newInstance(Telefono.class));</span>
<span class="nc" id="L689">        return listaDis;</span>

    }  

    /**
     * &lt;p&gt;Método para mostrar las compras individuales de cada cliente&lt;/p&gt;
     * @param id identificador del cliente a consultar    
    */ 
    public List&lt;Pedido&gt; mostrarC(int id) {
        

<span class="nc" id="L700">        String sql = &quot;select *from ventas.view1 where id_cliente = ? and compra =1 &quot;;</span>
<span class="nc" id="L701">        Object[] args = { id };</span>
<span class="nc" id="L702">        List&lt;Pedido&gt; listaF = jdbcTemplate.query(sql,args,  BeanPropertyRowMapper.newInstance(Pedido.class));</span>
<span class="nc" id="L703">        return listaF;</span>

    }

    /**
     * &lt;p&gt;Retornar una lista con información de los pedidos&lt;/p&gt;
     * @return listaF retorna una lista del tipo Pedido para más adelante gráficarlos
    
    */ 
    public List&lt;Pedido&gt; board() {        

<span class="fc" id="L714">        String sql = &quot;select nombref, sum(cantidad) as cantidad from ventas.view3  where compra =1  group by nombref  &quot;;        </span>
<span class="fc" id="L715">        List&lt;Pedido&gt; listaF = jdbcTemplate.query(sql,  BeanPropertyRowMapper.newInstance(Pedido.class));</span>
<span class="fc" id="L716">        return listaF;</span>

    }

    //TODO: Métodos para el manejo de las fabricas 
    /**
     * &lt;p&gt;Método para mostrar la info de todas las fabircas dentro de la bd&lt;/p&gt;
     * @return listaDis que es una lista con los datos de todas las fabricas
      
    */ 
    public List&lt;Fabrica&gt; listFabrica() {
<span class="nc" id="L727">        String sql = &quot;select *from VENTAS.fabrica&quot;;</span>
<span class="nc" id="L728">        List&lt;Fabrica&gt; listaDis = jdbcTemplate.query(sql, BeanPropertyRowMapper.newInstance(Fabrica.class));</span>
<span class="nc" id="L729">        return listaDis;</span>

    }

    /**
     * &lt;p&gt;Método para guardar los datos de una fabrica&lt;/p&gt;
     * @param nuevo objeto de tipo fabrica para guardar los datos de la fab en la bd
     * @throws IOException 
      
    */ 
    public void guardarFabrica(Fabrica nuevo) throws IOException {

  

<span class="nc" id="L743">        SimpleJdbcInsert insertActor = new SimpleJdbcInsert(jdbcTemplate);</span>
<span class="nc" id="L744">        insertActor.withSchemaName(&quot;VENTAS&quot;).withTableName(&quot;FABRICA&quot;).usingColumns(&quot;IP&quot;,&quot;PUERTO&quot;,&quot;NOMBREF&quot;);</span>
<span class="nc" id="L745">        BeanPropertySqlParameterSource param = new BeanPropertySqlParameterSource(nuevo);</span>

<span class="nc" id="L747">        insertActor.execute(param);</span>



<span class="nc" id="L751">    }</span>

    /**
     * &lt;p&gt;Método para obtener información de una  fabrica&lt;/p&gt;
     * @param id el identificador de la fabrica para obtener sus datos 
     * @return listaIn que es una lista del tipo fabrica, tiene los datos de la fabrica en particular
     
    */ 
    public List&lt;Fabrica&gt; getFab(int id) {
<span class="nc" id="L760">        String sql = &quot;select *from VENTAS.fabrica where id_fabrica = ?&quot;;</span>
<span class="nc" id="L761">        Object[] args = { id };</span>
<span class="nc" id="L762">        List&lt;Fabrica&gt; listaIn = jdbcTemplate.query(sql, args, BeanPropertyRowMapper.newInstance(Fabrica.class));</span>
<span class="nc" id="L763">        return listaIn;</span>

    }
     /**
     * &lt;p&gt;Método para obtener información de una  fabrica&lt;/p&gt;
     * @param id el identificador de la fabrica para obtener sus datos 
     * @return listaIn que es una lista del tipo fabrica, tiene los datos de la fabrica en particular
     
    */ 
    public List&lt;Fabrica&gt; getFabdaots(int id) {
<span class="nc" id="L773">        String sql = &quot;select *from ventas.fabrica inner join ventas.bodega on id_fabrica =origen where id_fabrica =?&quot;;</span>
<span class="nc" id="L774">        Object[] args = { id };</span>
<span class="nc" id="L775">        List&lt;Fabrica&gt; listaIn = jdbcTemplate.query(sql, args, BeanPropertyRowMapper.newInstance(Fabrica.class));</span>
<span class="nc" id="L776">        return listaIn;</span>

    }


    /**
     * &lt;p&gt;Método para eliminar el acceso a una fabrica&lt;/p&gt;
     * @param id el identificador de la fabrica para eliminarlo
     
    */ 
    public void deletefab(int id) {
<span class="nc" id="L787">        String sql = &quot;DELETE FROM VENTAS.fabrica WHERE id_fabrica = ?&quot;;</span>
<span class="nc" id="L788">        jdbcTemplate.update(sql, id);</span>
<span class="nc" id="L789">    }</span>

    /**
     * &lt;p&gt;Método secundario para salvar telefonos que se reciben del rest&lt;/p&gt;
     * @param nuevo que es el objeto de telefono a guardar en la db
     * @throws IOException
     
    */ 
    public void save2(Telefono nuevo) throws IOException {

  

<span class="nc" id="L801">        SimpleJdbcInsert insertActor = new SimpleJdbcInsert(jdbcTemplate);</span>
<span class="nc" id="L802">        insertActor.withSchemaName(&quot;VENTAS&quot;).withTableName(&quot;BODEGA&quot;).usingColumns( &quot;existencia&quot;,</span>
                &quot;precio_lista&quot;, &quot;codigo_modelo&quot;, &quot;ram&quot;, &quot;almacenamiento&quot;, &quot;procesador&quot;, &quot;numero_cores&quot;, &quot;color&quot;,
                &quot;descripcion&quot;, &quot;nombret&quot;,&quot;origen&quot;,&quot;id_estados&quot;);
<span class="nc" id="L805">        BeanPropertySqlParameterSource param = new BeanPropertySqlParameterSource(nuevo);</span>

<span class="nc" id="L807">        insertActor.execute(param);</span>
<span class="nc" id="L808">        }</span>


     /**
      * @deprecated
     * &lt;p&gt;Método para mostrar los pedidos realizados &lt;/p&gt;
     
    */ 
    public List&lt;Telefono&gt; listPedidoF() {
<span class="nc" id="L817">        String sql = &quot;select *from ventas.estadosf inner join(select *from VENTAS.bodega inner join VENTAS.fabrica on origen = id_fabrica where id_estados = 1)a on ID_ESTADOF = ID_ESTADOS&quot;;</span>
<span class="nc" id="L818">        List&lt;Telefono&gt; listaDis = jdbcTemplate.query(sql, BeanPropertyRowMapper.newInstance(Telefono.class));</span>
<span class="nc" id="L819">        return listaDis;</span>

    }

    /**
     * &lt;p&gt;Método para confirmar pedido, cambia el estado del pedido dentro de la bd para confirmarlo&lt;/p&gt;
     * @param n que es un objeto del tipo telefono que es la terminal que se confirma para el pedido 
     
    */ 
    public void confirmarP(Telefono n) {
<span class="nc" id="L829">        String sql = &quot;UPDATE VENTAS.bodega set id_estados=:id_estados where id_bodega=:id_bodega&quot;;</span>
<span class="nc" id="L830">        BeanPropertySqlParameterSource param = new BeanPropertySqlParameterSource(n);</span>

<span class="nc" id="L832">        NamedParameterJdbcTemplate template = new NamedParameterJdbcTemplate(jdbcTemplate);</span>

<span class="nc" id="L834">        template.update(sql, param);</span>

<span class="nc" id="L836">    }</span>

    /**
     * &lt;p&gt;Método para generar un listado con las ventas realizadas&lt;/p&gt;
     * @return listaDis que es una lista con los telefonos vendidos
     
    */ 
    public List&lt;EnviarCorreo&gt; listaReporte(int origen) {
<span class="nc" id="L844">        String sql = &quot;select nombret, cantidadp, cantidadp_a, total_c,origen  from ventas.fabrica inner join(select *from ventas.bodega inner join ventas.pedido using(id_bodega))a on origen = id_fabrica where id_estado = 2 and origen = ?&quot;;</span>
<span class="nc" id="L845">        Object[] args = { origen };</span>
<span class="nc" id="L846">        List&lt;EnviarCorreo&gt; listaDis = jdbcTemplate.query(sql,args, BeanPropertyRowMapper.newInstance(EnviarCorreo.class));</span>
<span class="nc" id="L847">        return listaDis;</span>

    }

    public void asignarNum(int dueño,int times) {
<span class="nc" id="L852">        String sql = &quot;UPDATE VENTAS.numeros_serie set estadov=1,dueño=? where estadov= 0 and rownum &lt;=  &quot; + times+ &quot;&quot;;</span>
<span class="nc" id="L853">        jdbcTemplate.update(sql, dueño);</span>
<span class="nc" id="L854">    }</span>

    public void asignarNumPermanente(int dueño,int times) {
<span class="nc" id="L857">        String sql = &quot;UPDATE VENTAS.numeros_serie set estadov=1,dueño=?  rownum &lt;=  &quot; + times+ &quot;&quot;;</span>
<span class="nc" id="L858">        jdbcTemplate.update(sql, dueño);</span>
<span class="nc" id="L859">    }</span>
    
    
    
   


  


















}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>